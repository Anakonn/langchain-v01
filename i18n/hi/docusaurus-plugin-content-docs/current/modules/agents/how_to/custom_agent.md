---
sidebar_position: 0
translated: true
---

рдпрд╣ рдиреЛрдЯрдмреБрдХ рдЖрдкрдХреЗ рдЕрдкрдиреЗ рдХрд╕реНрдЯрдо рдПрдЬреЗрдВрдЯ рдХреЛ рдХреИрд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рдП, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рддрд╛ рд╣реИред

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╣рдо OpenAI Tool Calling рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпрд╣ рдПрдЬреЗрдВрдЯ рдмрдирд╛рдПрдВрдЧреЗред
**рдпрд╣ рдПрдЬреЗрдВрдЯ рдмрдирд╛рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рддрд░реАрдХрд╛ рд╣реИред**

рд╣рдо рдкрд╣рд▓реЗ рдЗрд╕реЗ рдореЗрдореЛрд░реА рдХреЗ рдмрд┐рдирд╛ рдмрдирд╛рдПрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рд╣рдо рдореЗрдореЛрд░реА рдХреЛ рдХреИрд╕реЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдП, рдпрд╣ рднреА рджрд┐рдЦрд╛рдПрдВрдЧреЗред
рдореЗрдореЛрд░реА рд╡рд╛рд░реНрддрд╛рд▓рд╛рдк рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред

## LLM рд▓реЛрдб рдХрд░реЗрдВ

рдкрд╣рд▓реЗ, рдЪрд▓рд┐рдП рдЙрд╕ рднрд╛рд╖рд╛ рдореЙрдбрд▓ рдХреЛ рд▓реЛрдб рдХрд░реЗрдВ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рдПрдЬреЗрдВрдЯ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗред

```python
from langchain_openai import ChatOpenAI

llm = ChatOpenAI(model="gpt-3.5-turbo", temperature=0)
```

## рдЙрдкрдХрд░рдг рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВ

рдЕрдЧрд▓рд╛ рдХрджрдо, рдХреБрдЫ рдЙрдкрдХрд░рдг рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛ рд╣реИред
рдЪрд▓рд┐рдП рдПрдХ рдмрд╣реБрдд рд╣реА рд╕рд░рд▓ Python рдлрд╝рдВрдХреНрд╢рди рд▓рд┐рдЦрддреЗ рд╣реИрдВ рдЬреЛ рдХрд┐рд╕реА рджрд┐рдП рдЧрдП рд╢рдмреНрдж рдХреА рд▓рдВрдмрд╛рдИ рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣рд╛рдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рди рдбреЙрдХреНрд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛рдлреА рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВред рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [рдпрд╣рд╛рдВ](/docs/modules/tools/custom_tools) рдкрдврд╝реЗрдВред

```python
from langchain.agents import tool


@tool
def get_word_length(word: str) -> int:
    """Returns the length of a word."""
    return len(word)


get_word_length.invoke("abc")
```

```output
3
```

```python
tools = [get_word_length]
```

## рдкреНрд░реЛрдореНрдкреНрдЯ рдмрдирд╛рдПрдВ

рдЕрдм рдЖрдЗрдП рдкреНрд░реЛрдореНрдкреНрдЯ рдмрдирд╛рддреЗ рд╣реИрдВред
рдХреНрдпреЛрдВрдХрд┐ OpenAI Function Calling рдЙрдкрдХрд░рдг рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд рд╣реИ, рд╣рдореЗрдВ рддрд░реНрдХ рдХрд░рдиреЗ рдпрд╛ рдЖрдЙрдЯрдкреБрдЯ рдкреНрд░рд╛рд░реВрдк рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреЛрдИ рдирд┐рд░реНрджреЗрд╢ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред
рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреЗрд╡рд▓ рджреЛ рдЗрдирдкреБрдЯ рдЪрд░ рд╣реЛрдВрдЧреЗ: `input` рдФрд░ `agent_scratchpad`ред `input` рдореЗрдВ рдЙрдкрдпреЛрдХреНрддрд╛ рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред `agent_scratchpad` рдореЗрдВ рдкрд┐рдЫрд▓реЗ рдПрдЬреЗрдВрдЯ рдЙрдкрдХрд░рдг рдЖрд╣реНрд╡рд╛рди рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд рдЙрдкрдХрд░рдг рдЖрдЙрдЯрдкреБрдЯ рдХрд╛ рдЕрдиреБрдХреНрд░рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

```python
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder

prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "You are very powerful assistant, but don't know current events",
        ),
        ("user", "{input}"),
        MessagesPlaceholder(variable_name="agent_scratchpad"),
    ]
)
```

## рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ LLM рд╕реЗ рдмрд╛рдВрдзреЗрдВ

рдПрдЬреЗрдВрдЯ рдХреЛ рдХреМрди рд╕реЗ рдЙрдкрдХрд░рдг рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдХреИрд╕реЗ рд╣реЛрддреА рд╣реИ?

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо OpenAI Tool Calling LLMs рдкрд░ рдирд┐рд░реНрднрд░ рд╣реИрдВ, рдЬреЛ рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ рдПрдХ рдЕрд▓рдЧ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЗрддреЗ рд╣реИрдВ рдФрд░ рдЙрди рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ рдХрдм рдЖрдордВрддреНрд░рд┐рдд рдХрд░рдирд╛ рд╣реИ, рдЗрд╕рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд┐рдП рдЧрдП рд╣реИрдВред

рд╣рдорд╛рд░реЗ рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ рдПрдЬреЗрдВрдЯ рддрдХ рдкрд╣реБрдВрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЙрдиреНрд╣реЗрдВ [OpenAI рдЙрдкрдХрд░рдг рдкреНрд░рд╛рд░реВрдк](https://platform.openai.com/docs/api-reference/chat/create) рдореЗрдВ рдкреНрд░рд╛рд░реВрдкрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╣рдорд╛рд░реЗ рдореЙрдбрд▓ рдХреЛ рдкрд╛рд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред (рдлрд╝рдВрдХреНрд╢рди рдХреЛ `bind` рдХрд░рдХреЗ, рд╣рдо рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдХрд┐ рд╡реЗ рд╣рд░ рдмрд╛рд░ рдЬрдм рдореЙрдбрд▓ рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддрдм рдЙрдиреНрд╣реЗрдВ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред)

```python
llm_with_tools = llm.bind_tools(tools)
```

## рдПрдЬреЗрдВрдЯ рдмрдирд╛рдПрдВ

рдЗрди рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдПрдХ рд╕рд╛рде рд░рдЦрдХрд░, рд╣рдо рдЕрдм рдПрдЬреЗрдВрдЯ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред
рд╣рдо рджреЛ рдЕрдВрддрд┐рдо рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдлрд╝рдВрдХреНрд╢рди рдЖрдпрд╛рдд рдХрд░реЗрдВрдЧреЗ: рдПрдХ рдШрдЯрдХ рдордзреНрдпрд╡рд░реНрддреА рдЪрд░рдгреЛрдВ рдХреЛ (рдПрдЬреЗрдВрдЯ рдХреНрд░рд┐рдпрд╛, рдЙрдкрдХрд░рдг рдЖрдЙрдЯрдкреБрдЯ рдпреБрдЧреНрдореЛрдВ) рдЗрдирдкреБрдЯ рд╕рдВрджреЗрд╢реЛрдВ рдореЗрдВ рдкреНрд░рд╛рд░реВрдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдФрд░ рдПрдХ рдШрдЯрдХ рдПрдЬреЗрдВрдЯ рдХреНрд░рд┐рдпрд╛/рдПрдЬреЗрдВрдЯ рд╕рдорд╛рдкреНрддрд┐ рдореЗрдВ рдЖрдЙрдЯрдкреБрдЯ рд╕рдВрджреЗрд╢ рдХреЛ рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

```python
from langchain.agents.format_scratchpad.openai_tools import (
    format_to_openai_tool_messages,
)
from langchain.agents.output_parsers.openai_tools import OpenAIToolsAgentOutputParser

agent = (
    {
        "input": lambda x: x["input"],
        "agent_scratchpad": lambda x: format_to_openai_tool_messages(
            x["intermediate_steps"]
        ),
    }
    | prompt
    | llm_with_tools
    | OpenAIToolsAgentOutputParser()
)
```

```python
from langchain.agents import AgentExecutor

agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)
```

```python
list(agent_executor.stream({"input": "How many letters in the word eudca"}))
```

```output


[1m> Entering new AgentExecutor chain...[0m
[32;1m[1;3m
Invoking: `get_word_length` with `{'word': 'eudca'}`


[0m[36;1m[1;3m5[0m[32;1m[1;3mThere are 5 letters in the word "eudca".[0m

[1m> Finished chain.[0m
```

```output
[{'actions': [OpenAIToolAgentAction(tool='get_word_length', tool_input={'word': 'eudca'}, log="\nInvoking: `get_word_length` with `{'word': 'eudca'}`\n\n\n", message_log=[AIMessageChunk(content='', additional_kwargs={'tool_calls': [{'index': 0, 'id': 'call_A07D5TuyqcNIL0DIEVRPpZkg', 'function': {'arguments': '{\n  "word": "eudca"\n}', 'name': 'get_word_length'}, 'type': 'function'}]})], tool_call_id='call_A07D5TuyqcNIL0DIEVRPpZkg')],
  'messages': [AIMessageChunk(content='', additional_kwargs={'tool_calls': [{'index': 0, 'id': 'call_A07D5TuyqcNIL0DIEVRPpZkg', 'function': {'arguments': '{\n  "word": "eudca"\n}', 'name': 'get_word_length'}, 'type': 'function'}]})]},
 {'steps': [AgentStep(action=OpenAIToolAgentAction(tool='get_word_length', tool_input={'word': 'eudca'}, log="\nInvoking: `get_word_length` with `{'word': 'eudca'}`\n\n\n", message_log=[AIMessageChunk(content='', additional_kwargs={'tool_calls': [{'index': 0, 'id': 'call_A07D5TuyqcNIL0DIEVRPpZkg', 'function': {'arguments': '{\n  "word": "eudca"\n}', 'name': 'get_word_length'}, 'type': 'function'}]})], tool_call_id='call_A07D5TuyqcNIL0DIEVRPpZkg'), observation=5)],
  'messages': [FunctionMessage(content='5', name='get_word_length')]},
 {'output': 'There are 5 letters in the word "eudca".',
  'messages': [AIMessage(content='There are 5 letters in the word "eudca".')]}]
```

рдпрджрд┐ рд╣рдо рдЗрд╕реЗ рдЖрдзрд╛рд░ LLM рд╕реЗ рддреБрд▓рдирд╛ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ LLM рдЕрдХреЗрд▓реЗ рд╕рдВрдШрд░реНрд╖ рдХрд░рддрд╛ рд╣реИред

```python
llm.invoke("How many letters in the word educa")
```

```output
AIMessage(content='There are 6 letters in the word "educa".')
```

## рдореЗрдореЛрд░реА рдЬреЛрдбрд╝рдирд╛

рдпрд╣ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд╣реИ - рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдПрдЬреЗрдВрдЯ рд╣реИ!
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдПрдЬреЗрдВрдЯ рд╕реНрдерд┐рд░рддрд╛ рд░рд╣рд┐рдд рд╣реИ - рдпрд╣ рдкрд┐рдЫрд▓реА рдмрд╛рддрдЪреАрдд рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рднреА рдпрд╛рдж рдирд╣реАрдВ рд░рдЦрддрд╛ рд╣реИред
рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ рдлреЙрд▓реЛ-рдЕрдк рдкреНрд░рд╢реНрди рдирд╣реАрдВ рдкреВрдЫ рд╕рдХрддреЗред
рдЪрд▓рд┐рдП рдореЗрдореЛрд░реА рдЬреЛрдбрд╝рдХрд░ рдЗрд╕реЗ рдареАрдХ рдХрд░рддреЗ рд╣реИрдВред

рдЗрд╕реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рджреЛ рдЪреАрдЬреЗрдВ рдХрд░рдиреА рд╣реЛрдВрдЧреА:

1. рдкреНрд░реЛрдореНрдкреНрдЯ рдореЗрдВ рдореЗрдореЛрд░реА рдЪрд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдЬрдЧрд╣ рдЬреЛрдбрд╝рдирд╛
2. рдЪреИрдЯ рдЗрддрд┐рд╣рд╛рд╕ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдирд╛

рдкрд╣рд▓реЗ, рдкреНрд░реЛрдореНрдкреНрдЯ рдореЗрдВ рдореЗрдореЛрд░реА рдХреЗ рд▓рд┐рдП рдПрдХ рдЬрдЧрд╣ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред
рд╣рдо рдпрд╣ `"chat_history"` рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдХ рдкреНрд▓реЗрд╕рд╣реЛрд▓реНрдбрд░ рдЬреЛрдбрд╝рдХрд░ рдХрд░рддреЗ рд╣реИрдВред
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╣рдо рдЗрд╕реЗ рдирдП рдЙрдкрдпреЛрдХреНрддрд╛ рдЗрдирдкреБрдЯ (рд╡рд╛рд░реНрддрд╛рд▓рд╛рдк рдкреНрд░рд╡рд╛рд╣ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП) рд╕реЗ рдКрдкрд░ рд░рдЦрддреЗ рд╣реИрдВред

```python
from langchain_core.prompts import MessagesPlaceholder

MEMORY_KEY = "chat_history"
prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "You are very powerful assistant, but bad at calculating lengths of words.",
        ),
        MessagesPlaceholder(variable_name=MEMORY_KEY),
        ("user", "{input}"),
        MessagesPlaceholder(variable_name="agent_scratchpad"),
    ]
)
```

рдлрд┐рд░ рд╣рдо рдЪреИрдЯ рдЗрддрд┐рд╣рд╛рд╕ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реВрдЪреА рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

```python
from langchain_core.messages import AIMessage, HumanMessage

chat_history = []
```

рдлрд┐рд░ рд╣рдо рдЗрди рд╕рдмрдХреЛ рдПрдХ рд╕рд╛рде рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ!

```python
agent = (
    {
        "input": lambda x: x["input"],
        "agent_scratchpad": lambda x: format_to_openai_tool_messages(
            x["intermediate_steps"]
        ),
        "chat_history": lambda x: x["chat_history"],
    }
    | prompt
    | llm_with_tools
    | OpenAIToolsAgentOutputParser()
)
agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)
```

рдЪрд▓рд╛рддреЗ рд╕рдордп, рд╣рдореЗрдВ рдЗрдирдкреБрдЯ рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рдЪреИрдЯ рдЗрддрд┐рд╣рд╛рд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдЯреНрд░реИрдХ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

```python
input1 = "how many letters in the word educa?"
result = agent_executor.invoke({"input": input1, "chat_history": chat_history})
chat_history.extend(
    [
        HumanMessage(content=input1),
        AIMessage(content=result["output"]),
    ]
)
agent_executor.invoke({"input": "is that a real word?", "chat_history": chat_history})
```

```output


[1m> Entering new AgentExecutor chain...[0m
[32;1m[1;3m
Invoking: `get_word_length` with `{'word': 'educa'}`


[0m[36;1m[1;3m5[0m[32;1m[1;3mThere are 5 letters in the word "educa".[0m

[1m> Finished chain.[0m


[1m> Entering new AgentExecutor chain...[0m
[32;1m[1;3mNo, "educa" is not a real word in English.[0m

[1m> Finished chain.[0m
```

```output
{'input': 'is that a real word?',
 'chat_history': [HumanMessage(content='how many letters in the word educa?'),
  AIMessage(content='There are 5 letters in the word "educa".')],
 'output': 'No, "educa" is not a real word in English.'}
```
