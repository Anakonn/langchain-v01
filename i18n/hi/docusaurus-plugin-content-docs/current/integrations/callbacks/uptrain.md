---
translated: true
---

<h1>UpTrain</h1>

> UpTrain [[github](https://github.com/uptrain-ai/uptrain) || [website](https://uptrain.ai/) || [docs](https://docs.uptrain.ai/getting-started/introduction)] рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рд╣реИ рдЬреЛ LLM рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдФрд░ рд╕реБрдзрд╛рд░ рдХрд░рддрд╛ рд╣реИред рдпрд╣ 20+ рдкреВрд░реНрд╡-рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдЪреЗрдХ (рднрд╛рд╖рд╛, рдХреЛрдб, рдПрдореНрдмреЗрдбрд┐рдВрдЧ рдЙрдкрдпреЛрдЧ рдорд╛рдорд▓реЛрдВ рдХреЛ рдХрд╡рд░ рдХрд░рддреЗ рд╣реБрдП) рдХреЗ рд▓рд┐рдП рдЧреНрд░реЗрдб рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рд╡рд┐рдлрд▓рддрд╛ рдХреЗ рдорд╛рдорд▓реЛрдВ рдкрд░ рдореВрд▓ рдХрд╛рд░рдг рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

## UpTrain рдХреЙрд▓рдмреИрдХ рд╣реИрдВрдбрд▓рд░

рдпрд╣ рдиреЛрдЯрдмреБрдХ UpTrain рдХреЙрд▓рдмреИрдХ рд╣реИрдВрдбрд▓рд░ рдХреЛ рдЖрдкрдХреА рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдореЗрдВ рд╕реБрдЪрд╛рд░реВ рд░реВрдк рд╕реЗ рдПрдХреАрдХреГрдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рд╡рд┐рд╡рд┐рдз рдореВрд▓реНрдпрд╛рдВрдХрдиреЛрдВ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рддрд╛ рд╣реИред рд╣рдордиреЗ рдХреБрдЫ рдореВрд▓реНрдпрд╛рдВрдХрди рдЪреБрдиреЗ рд╣реИрдВ рдЬреЛ рд╣рдореЗрдВ рд╢реНрд░реГрдВрдЦрд▓рд╛рдУрдВ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд▓рдЧреЗред рдпреЗ рдореВрд▓реНрдпрд╛рдВрдХрди рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЪрд▓рддреЗ рд╣реИрдВ, рдФрд░ рдкрд░рд┐рдгрд╛рдо рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред UpTrain рдХреЗ рдореВрд▓реНрдпрд╛рдВрдХрдиреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [рдпрд╣рд╛рдВ](https://github.com/uptrain-ai/uptrain?tab=readme-ov-file#pre-built-evaluations-we-offer-) рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИред

Langchain рд╕реЗ рдЪрдпрдирд┐рдд рд░рд┐рдЯреНрд░реАрд╡рд░ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдП рд╣рд╛рдЗрд▓рд╛рдЗрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВ:

### 1. **рд╡реИрдирд┐рд▓рд╛ RAG**:

RAG рдкреНрд░рд╕рдВрдЧ рдХреЛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЧреБрдгрд╡рддреНрддрд╛ рдХреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рддреЗ рд╣реИрдВ:

- **[рд╕рдВрджрд░реНрдн рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХрддрд╛](https://docs.uptrain.ai/predefined-evaluations/context-awareness/context-relevance)**: рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрд╡реЗрд░реА рд╕реЗ рдкреНрд░рд╛рдкреНрдд рд╕рдВрджрд░реНрдн рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╣реИред
- **[рддрдереНрдпрд╛рддреНрдордХ рд╕рдЯреАрдХрддрд╛](https://docs.uptrain.ai/predefined-evaluations/context-awareness/factual-accuracy)**: рдпрд╣ рдЖрдХрд▓рди рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ LLM рд╣рд▓реНрд▓реВрд╕рд┐рдиреЗрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдЧрд▓рдд рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХрд░ рд░рд╣рд╛ рд╣реИред
- **[рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреВрд░реНрдгрддрд╛](https://docs.uptrain.ai/predefined-evaluations/response-quality/response-completeness)**: рдпрд╣ рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреНрд╡реЗрд░реА рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрд░реЛрдзрд┐рдд рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рд╢рд╛рдорд┐рд▓ рд╣реИред

### 2. **рдмрд╣реБ рдХреНрд╡реЗрд░реА рдЬрдирд░реЗрд╢рди**:

MultiQueryRetriever рдореВрд▓ рдХреНрд╡реЗрд░реА рдХреЗ рд╕рдорд╛рди рдЕрд░реНрде рд╡рд╛рд▓реЗ рдХреНрд╡реЗрд░реА рдХреЗ рдХрдИ рд╕рдВрд╕реНрдХрд░рдг рдмрдирд╛рддрд╛ рд╣реИред рдЬрдЯрд┐рд▓рддрд╛ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рд╣рдо рдкрд┐рдЫрд▓реЗ рдореВрд▓реНрдпрд╛рдВрдХрдиреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ:

- **[рдмрд╣реБ рдХреНрд╡реЗрд░реА рд╕рдЯреАрдХрддрд╛](https://docs.uptrain.ai/predefined-evaluations/query-quality/multi-query-accuracy)**: рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЙрддреНрдкрдиреНрди рдмрд╣реБ-рдХреНрд╡реЗрд░реА рдореВрд▓ рдХреНрд╡реЗрд░реА рдХреЗ рд╕рдорд╛рди рдЕрд░реНрде рд░рдЦрддреА рд╣реИрдВред

### 3. **рд╕рдВрджрд░реНрдн рд╕рдВрдкреАрдбрд╝рди рдФрд░ рдкреБрдирдГ рдХреНрд░рдордг**:

рдкреБрдирдГ рдХреНрд░рдордг рдореЗрдВ рдХреНрд╡реЗрд░реА рдХреЗ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХрддрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдиреЛрдбреНрд╕ рдХреЛ рдкреБрдирдГ рдХреНрд░рдорд┐рдд рдХрд░рдирд╛ рдФрд░ рд╢реАрд░реНрд╖ n рдиреЛрдбреНрд╕ рдХрд╛ рдЪрдпрди рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред рдЪреВрдВрдХрд┐ рдкреБрдирдГ рдХреНрд░рдордг рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдиреЛрдбреНрд╕ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХрдо рд╣реЛ рд╕рдХрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рддреЗ рд╣реИрдВ:

- **[рд╕рдВрджрд░реНрдн рдкреБрдирдГ рдХреНрд░рдордг](https://docs.uptrain.ai/predefined-evaluations/context-awareness/context-reranking)**: рдпрд╣ рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдкреБрдирдГ рдХреНрд░рдорд┐рдд рдиреЛрдбреНрд╕ рдХрд╛ рдХреНрд░рдо рдореВрд▓ рдХреНрд░рдо рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдХреНрд╡реЗрд░реА рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╣реИред
- **[рд╕рдВрджрд░реНрдн рд╕рдВрдХреНрд╖рд┐рдкреНрддрддрд╛](https://docs.uptrain.ai/predefined-evaluations/context-awareness/context-conciseness)**: рдпрд╣ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдХрдо рдиреЛрдбреНрд╕ рднреА рдЕрдкреЗрдХреНрд╖рд┐рдд рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред

рдпреЗ рдореВрд▓реНрдпрд╛рдВрдХрди рд╕рд╛рдореВрд╣рд┐рдХ рд░реВрдк рд╕реЗ RAG, MultiQueryRetriever рдФрд░ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рдкреБрдирдГ рдХреНрд░рдордг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдордЬрдмреВрддреА рдФрд░ рдкреНрд░рднрд╛рд╡рд╢реАрд▓рддрд╛ рдХреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реИрдВред

## рдирд┐рд░реНрднрд░рддрд╛рдПрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ

```python
%pip install -qU langchain langchain_openai uptrain faiss-cpu flashrank
```

```output
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)

[33mWARNING: There was an error checking the latest version of pip.[0m[33m
[0mNote: you may need to restart the kernel to use updated packages.
```

рдиреЛрдЯ: рдЖрдк `faiss-gpu` рднреА рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ `faiss-cpu` рдХреЗ рдмрдЬрд╛рдп рдпрджрд┐ рдЖрдк рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ GPU-рд╕рдХреНрд╖рдо рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред

## рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЖрдпрд╛рдд рдХрд░реЗрдВ

```python
from getpass import getpass

from langchain.chains import RetrievalQA
from langchain.retrievers import ContextualCompressionRetriever
from langchain.retrievers.document_compressors import FlashrankRerank
from langchain.retrievers.multi_query import MultiQueryRetriever
from langchain_community.callbacks.uptrain_callback import UpTrainCallbackHandler
from langchain_community.document_loaders import TextLoader
from langchain_community.vectorstores import FAISS
from langchain_core.output_parsers.string import StrOutputParser
from langchain_core.prompts.chat import ChatPromptTemplate
from langchain_core.runnables.passthrough import RunnablePassthrough
from langchain_openai import ChatOpenAI, OpenAIEmbeddings
from langchain_text_splitters import (
    RecursiveCharacterTextSplitter,
)
```

## рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд▓реЛрдб рдХрд░реЗрдВ

```python
loader = TextLoader("../../modules/state_of_the_union.txt")
documents = loader.load()
```

## рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЛ рдЯреБрдХрдбрд╝реЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░реЗрдВ

```python
text_splitter = RecursiveCharacterTextSplitter(chunk_size=1000, chunk_overlap=0)
chunks = text_splitter.split_documents(documents)
```

## рд░рд┐рдЯреНрд░реАрд╡рд░ рдмрдирд╛рдПрдВ

```python
embeddings = OpenAIEmbeddings()
db = FAISS.from_documents(chunks, embeddings)
retriever = db.as_retriever()
```

## LLM рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВ

```python
llm = ChatOpenAI(temperature=0, model="gpt-4")
```

## openai API рдХреБрдВрдЬреА рд╕реЗрдЯ рдХрд░реЗрдВ

рдпрд╣ рдХреБрдВрдЬреА рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред UpTrain LLM рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП GPT рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

```python
OPENAI_API_KEY = getpass()
```

## рд╕реЗрдЯрдЕрдк

рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдкреНрд░рддреНрдпреЗрдХ рд░рд┐рдЯреНрд░реАрд╡рд░ рдХреЗ рд▓рд┐рдП, рд╣рд╕реНрддрдХреНрд╖реЗрдк рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓рдмреИрдХ рд╣реИрдВрдбрд▓рд░ рдХреЛ рдлрд┐рд░ рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛ рдмреЗрд╣рддрд░ рд╣реИред UpTrain рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рдХрд▓реНрдкреЛрдВ рдореЗрдВ рд╕реЗ рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВ:

### 1. **UpTrain рдХрд╛ рдУрдкрди-рд╕реЛрд░реНрд╕ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ (OSS)**:

рдЖрдк рдЕрдкрдиреЗ рдореЙрдбрд▓ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдУрдкрди-рд╕реЛрд░реНрд╕ рдореВрд▓реНрдпрд╛рдВрдХрди рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рдПрдХ OpenAI API рдХреБрдВрдЬреА рдкреНрд░рджрд╛рди рдХрд░рдиреА рд╣реЛрдЧреАред рдЖрдк рдЕрдкрдиреА рдХреБрдВрдЬреА [рдпрд╣рд╛рдВ](https://platform.openai.com/account/api-keys) рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдкреИрд░рд╛рдореАрдЯрд░:
- key_type="openai"
- api_key="OPENAI_API_KEY"
- project_name_prefix="PROJECT_NAME_PREFIX"

### 2. **UpTrain рдкреНрд░рдмрдВрдзрд┐рдд рд╕реЗрд╡рд╛ рдФрд░ рдбреИрд╢рдмреЛрд░реНрдб**:

рдЖрдк [рдпрд╣рд╛рдВ](https://uptrain.ai/) рдПрдХ рдореБрдлреНрдд UpTrain рдЦрд╛рддрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдореБрдлреНрдд рдЯреНрд░рд╛рдпрд▓ рдХреНрд░реЗрдбрд┐рдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрдк рдЕрдзрд┐рдХ рдЯреНрд░рд╛рдпрд▓ рдХреНрд░реЗрдбрд┐рдЯ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ [UpTrain рдХреЗ рд░рдЦрд░рдЦрд╛рд╡рдХрд░реНрддрд╛рдУрдВ рд╕реЗ рдпрд╣рд╛рдВ рдХреЙрд▓ рдмреБрдХ рдХрд░реЗрдВ](https://calendly.com/uptrain-sourabh/30min)ред

UpTrain рдкреНрд░рдмрдВрдзрд┐рдд рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ:
1. рдЙрдиреНрдирдд рдбреНрд░рд┐рд▓-рдбрд╛рдЙрди рдФрд░ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде рдбреИрд╢рдмреЛрд░реНрдб
1. рд╡рд┐рдлрд▓ рдорд╛рдорд▓реЛрдВ рдХреЗ рдмреАрдЪ рд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рд╖рдпреЛрдВ рдкрд░ рдЕрдВрддрд░реНрджреГрд╖реНрдЯрд┐
1. рдЙрддреНрдкрд╛рджрди рдбреЗрдЯрд╛ рдкрд░ рдЕрд╡рд▓реЛрдХрдиреАрдпрддрд╛ рдФрд░ рд╡рд╛рд╕реНрддрд╡рд┐рдХ-рд╕рдордп рдирд┐рдЧрд░рд╛рдиреА
1. рдЖрдкрдХреА CI/CD рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЗ рд╕рд╛рде рд╕реБрд╕рдВрдЧрдд рдПрдХреАрдХрд░рдг рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд░реАрдЧреНрд░реЗрд╢рди рдкрд░реАрдХреНрд╖рдг

рдиреЛрдЯрдмреБрдХ рдореЗрдВ UpTrain рдкреНрд░рдмрдВрдзрд┐рдд рд╕реЗрд╡рд╛ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдбреИрд╢рдмреЛрд░реНрдб рдФрд░ рдЕрдВрддрд░реНрджреГрд╖реНрдЯрд┐ рдХреА рдХреБрдЫ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

рдкреИрд░рд╛рдореАрдЯрд░:
- key_type="uptrain"
- api_key="UPTRAIN_API_KEY"
- project_name_prefix="PROJECT_NAME_PREFIX"

**рдиреЛрдЯ:** `project_name_prefix` рдХрд╛ рдЙрдкрдпреЛрдЧ UpTrain рдбреИрд╢рдмреЛрд░реНрдб рдореЗрдВ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдирд╛рдореЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрд╕рд░реНрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдпреЗ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдореВрд▓реНрдпрд╛рдВрдХрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣реЛрдВрдЧреЗред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдк project_name_prefix="langchain" рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ multi_query рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдирд╛рдо "langchain_multi_query" рд╣реЛрдЧрд╛ред

# 1. рд╡реИрдирд┐рд▓рд╛ RAG

UpTrain рдХреЙрд▓рдмреИрдХ рд╣реИрдВрдбрд▓рд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХреНрд╡реЗрд░реА, рд╕рдВрджрд░реНрдн рдФрд░ рдЙрддреНрдкрдиреНрди рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдЧрд╛ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддреАрди рдореВрд▓реНрдпрд╛рдВрдХрди *(0 рд╕реЗ 1 рддрдХ рдЧреНрд░реЗрдбреЗрдб)* рдЪрд▓рд╛рдПрдЧрд╛:
- **[рд╕рдВрджрд░реНрдн рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХрддрд╛](https://docs.uptrain.ai/predefined-evaluations/context-awareness/context-relevance)**: рдпрд╣ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдХрд┐ рдХреНрд╡реЗрд░реА рд╕реЗ рдирд┐рдХрд╛рд▓рд╛ рдЧрдпрд╛ рд╕рдВрджрд░реНрдн рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╣реИ рдпрд╛ рдирд╣реАрдВред
- **[рддрдереНрдпрд╛рддреНрдордХ рд╕рдЯреАрдХрддрд╛](https://docs.uptrain.ai/predefined-evaluations/context-awareness/factual-accuracy)**: рдпрд╣ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдХрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд┐рддрдиреА рддрдереНрдпрд╛рддреНрдордХ рд░реВрдк рд╕реЗ рд╕рдЯреАрдХ рд╣реИред
- **[рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреВрд░реНрдгрддрд╛](https://docs.uptrain.ai/predefined-evaluations/response-quality/response-completeness)**: рдпрд╣ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдХрд┐ рдХреНрд╡реЗрд░реА рджреНрд╡рд╛рд░рд╛ рдкреВрдЫреЗ рдЧрдП рд╕рднреА рд╕рд╡рд╛рд▓реЛрдВ рдХрд╛ рдЙрддреНрддрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ рдпрд╛ рдирд╣реАрдВред

```python
# Create the RAG prompt
template = """Answer the question based only on the following context, which can include text and tables:
{context}
Question: {question}
"""
rag_prompt_text = ChatPromptTemplate.from_template(template)

# Create the chain
chain = (
    {"context": retriever, "question": RunnablePassthrough()}
    | rag_prompt_text
    | llm
    | StrOutputParser()
)

# Create the uptrain callback handler
uptrain_callback = UpTrainCallbackHandler(key_type="openai", api_key=OPENAI_API_KEY)
config = {"callbacks": [uptrain_callback]}

# Invoke the chain with a query
query = "What did the president say about Ketanji Brown Jackson"
docs = chain.invoke(query, config=config)
```

```output
[32m2024-04-17 17:03:44.969[0m | [1mINFO    [0m | [36muptrain.framework.evalllm[0m:[36mevaluate_on_server[0m:[36m378[0m - [1mSending evaluation request for rows 0 to <50 to the Uptrain[0m
[32m2024-04-17 17:04:05.809[0m | [1mINFO    [0m | [36muptrain.framework.evalllm[0m:[36mevaluate[0m:[36m367[0m - [1mLocal server not running, start the server to log data and visualize in the dashboard![0m


Question: What did the president say about Ketanji Brown Jackson
Response: The president mentioned that he had nominated Ketanji Brown Jackson to serve on the United States Supreme Court 4 days ago. He described her as one of the nation's top legal minds who will continue Justice BreyerтАЩs legacy of excellence. He also mentioned that she is a former top litigator in private practice, a former federal public defender, and comes from a family of public school educators and police officers. He described her as a consensus builder and noted that since her nomination, she has received a broad range of support from various groups, including the Fraternal Order of Police and former judges appointed by both Democrats and Republicans.

Context Relevance Score: 1.0
Factual Accuracy Score: 1.0
Response Completeness Score: 1.0
```

# 2. рдмрд╣реБ рдХреНрд╡реЗрд░реА рдЬрдирд░реЗрд╢рди

**MultiQueryRetriever** рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ RAG рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдореВрд▓ рдХреНрд╡реЗрд░реА рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рджрд╕реНрддрд╛рд╡реЗрдЬреЛрдВ рдХреЛ рд╡рд╛рдкрд╕ рдирд╣реАрдВ рджреЗ рд╕рдХрддреАред рдпрд╣ рдореВрд▓ рдХреНрд╡реЗрд░реА рдХреЗ рд╕рдорд╛рди рдЕрд░реНрде рд╡рд╛рд▓реА рдХрдИ рдХреНрд╡реЗрд░реА рдЬрдирд░реЗрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рд▓рд┐рдП рджрд╕реНрддрд╛рд╡реЗрдЬ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред

рдЗрд╕ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддрдХрд░реНрддрд╛ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, UpTrain рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореВрд▓реНрдпрд╛рдВрдХрди рдЪрд▓рд╛рдПрдЧрд╛:
- **[рдмрд╣реБ рдХреНрд╡реЗрд░реА рд╕рдЯреАрдХрддрд╛](https://docs.uptrain.ai/predefined-evaluations/query-quality/multi-query-accuracy)**: рдпрд╣ рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЙрддреНрдкрдиреНрди рдмрд╣реБ-рдХреНрд╡реЗрд░реА рдореВрд▓ рдХреНрд╡реЗрд░реА рдХреЗ рд╕рдорд╛рди рдЕрд░реНрде рд╡рд╛рд▓реА рд╣реИрдВред

```python
# Create the retriever
multi_query_retriever = MultiQueryRetriever.from_llm(retriever=retriever, llm=llm)

# Create the uptrain callback
uptrain_callback = UpTrainCallbackHandler(key_type="openai", api_key=OPENAI_API_KEY)
config = {"callbacks": [uptrain_callback]}

# Create the RAG prompt
template = """Answer the question based only on the following context, which can include text and tables:
{context}
Question: {question}
"""
rag_prompt_text = ChatPromptTemplate.from_template(template)

chain = (
    {"context": multi_query_retriever, "question": RunnablePassthrough()}
    | rag_prompt_text
    | llm
    | StrOutputParser()
)

# Invoke the chain with a query
question = "What did the president say about Ketanji Brown Jackson"
docs = chain.invoke(question, config=config)
```

```output
[32m2024-04-17 17:04:10.675[0m | [1mINFO    [0m | [36muptrain.framework.evalllm[0m:[36mevaluate_on_server[0m:[36m378[0m - [1mSending evaluation request for rows 0 to <50 to the Uptrain[0m
[32m2024-04-17 17:04:16.804[0m | [1mINFO    [0m | [36muptrain.framework.evalllm[0m:[36mevaluate[0m:[36m367[0m - [1mLocal server not running, start the server to log data and visualize in the dashboard![0m


Question: What did the president say about Ketanji Brown Jackson
Multi Queries:
  - How did the president comment on Ketanji Brown Jackson?
  - What were the president's remarks regarding Ketanji Brown Jackson?
  - What statements has the president made about Ketanji Brown Jackson?

Multi Query Accuracy Score: 0.5

[32m2024-04-17 17:04:22.027[0m | [1mINFO    [0m | [36muptrain.framework.evalllm[0m:[36mevaluate_on_server[0m:[36m378[0m - [1mSending evaluation request for rows 0 to <50 to the Uptrain[0m
[32m2024-04-17 17:04:44.033[0m | [1mINFO    [0m | [36muptrain.framework.evalllm[0m:[36mevaluate[0m:[36m367[0m - [1mLocal server not running, start the server to log data and visualize in the dashboard![0m


Question: What did the president say about Ketanji Brown Jackson
Response: The president mentioned that he had nominated Circuit Court of Appeals Judge Ketanji Brown Jackson to serve on the United States Supreme Court 4 days ago. He described her as one of the nation's top legal minds who will continue Justice BreyerтАЩs legacy of excellence. He also mentioned that since her nomination, she has received a broad range of supportтАФfrom the Fraternal Order of Police to former judges appointed by Democrats and Republicans.

Context Relevance Score: 1.0
Factual Accuracy Score: 1.0
Response Completeness Score: 1.0
```

# 3. рд╕рдВрджрд░реНрдн рд╕рдВрдкреАрдбрд╝рди рдФрд░ рдкреБрдирдГ рдХреНрд░рдордг

рдкреБрдирдГ рдХреНрд░рдордг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреНрд╡реЗрд░реА рдХреЗ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХрддрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдиреЛрдб рдХреЛ рдкреБрдирдГ рдХреНрд░рдорд┐рдд рдХрд░рдирд╛ рдФрд░ рд╢реАрд░реНрд╖ n рдиреЛрдб рдХреЛ рдЪреБрдирдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред рдХреНрдпреЛрдВрдХрд┐ рдкреБрдирдГ рдХреНрд░рдордг рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдиреЛрдб рдХреА рд╕рдВрдЦреНрдпрд╛ рдХрдо рд╣реЛ рд╕рдХрддреА рд╣реИ, рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рддреЗ рд╣реИрдВ:
- **[рд╕рдВрджрд░реНрдн рдкреБрдирдГ рдХреНрд░рдордг](https://docs.uptrain.ai/predefined-evaluations/context-awareness/context-reranking)**: рдпрд╣ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдХрд┐ рдХреНрдпрд╛ рдкреБрдирдГ рдХреНрд░рдорд┐рдд рдиреЛрдб рдХрд╛ рдХреНрд░рдо рдореВрд▓ рдХреНрд░рдо рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдХреНрд╡реЗрд░реА рдХреЗ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╣реИред
- **[рд╕рдВрджрд░реНрдн рд╕рдВрдХреНрд╖рд┐рдкреНрддрддрд╛](https://docs.uptrain.ai/predefined-evaluations/context-awareness/context-conciseness)**: рдпрд╣ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдХрд┐ рдХреНрдпрд╛ рдХрдо рдиреЛрдб рднреА рдЖрд╡рд╢реНрдпрдХ рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред

```python
# Create the retriever
compressor = FlashrankRerank()
compression_retriever = ContextualCompressionRetriever(
    base_compressor=compressor, base_retriever=retriever
)

# Create the chain
chain = RetrievalQA.from_chain_type(llm=llm, retriever=compression_retriever)

# Create the uptrain callback
uptrain_callback = UpTrainCallbackHandler(key_type="openai", api_key=OPENAI_API_KEY)
config = {"callbacks": [uptrain_callback]}

# Invoke the chain with a query
query = "What did the president say about Ketanji Brown Jackson"
result = chain.invoke(query, config=config)
```

```output
[32m2024-04-17 17:04:46.462[0m | [1mINFO    [0m | [36muptrain.framework.evalllm[0m:[36mevaluate_on_server[0m:[36m378[0m - [1mSending evaluation request for rows 0 to <50 to the Uptrain[0m
[32m2024-04-17 17:04:53.561[0m | [1mINFO    [0m | [36muptrain.framework.evalllm[0m:[36mevaluate[0m:[36m367[0m - [1mLocal server not running, start the server to log data and visualize in the dashboard![0m


Question: What did the president say about Ketanji Brown Jackson

Context Conciseness Score: 0.0
Context Reranking Score: 1.0

[32m2024-04-17 17:04:56.947[0m | [1mINFO    [0m | [36muptrain.framework.evalllm[0m:[36mevaluate_on_server[0m:[36m378[0m - [1mSending evaluation request for rows 0 to <50 to the Uptrain[0m
[32m2024-04-17 17:05:16.551[0m | [1mINFO    [0m | [36muptrain.framework.evalllm[0m:[36mevaluate[0m:[36m367[0m - [1mLocal server not running, start the server to log data and visualize in the dashboard![0m


Question: What did the president say about Ketanji Brown Jackson
Response: The President mentioned that he nominated Circuit Court of Appeals Judge Ketanji Brown Jackson to serve on the United States Supreme Court 4 days ago. He described her as one of the nation's top legal minds who will continue Justice BreyerтАЩs legacy of excellence.

Context Relevance Score: 1.0
Factual Accuracy Score: 1.0
Response Completeness Score: 0.5
```
