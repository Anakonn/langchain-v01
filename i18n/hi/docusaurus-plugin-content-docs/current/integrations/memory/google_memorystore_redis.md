---
translated: true
---

# рдЧреВрдЧрд▓ рдореЗрдореЛрд░реАрд╕реНрдЯреЛрд░ рдлреЙрд░ рд░реЗрдбрд┐рд╕

> [рдЧреВрдЧрд▓ рдХреНрд▓рд╛рдЙрдб рдореЗрдореЛрд░реАрд╕реНрдЯреЛрд░ рдлреЙрд░ рд░реЗрдбрд┐рд╕](https://cloud.google.com/memorystore/docs/redis/memorystore-for-redis-overview) рдПрдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ рд░реЗрдбрд┐рд╕ рдЗрди-рдореЗрдореЛрд░реА рдбреЗрдЯрд╛ рд╕реНрдЯреЛрд░ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд рд╣реИ рддрд╛рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреИрд╢ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдЬреЛ рд╕рдм-рдорд┐рд▓реАрд╕реЗрдХрдВрдб рдбреЗрдЯрд╛ рдПрдХреНрд╕реЗрд╕ рдкреНрд░рджрд╛рди рдХрд░реЗрдВред рдореЗрдореЛрд░реАрд╕реНрдЯреЛрд░ рдлреЙрд░ рд░реЗрдбрд┐рд╕ рдХреЗ рд▓реИрдВрдЧрдЪреЗрди рдПрдХреАрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ AI-рд╕рдВрдЪрд╛рд▓рд┐рдд рдЕрдиреБрднрд╡ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдХрд░реЗрдВред

рдпрд╣ рдиреЛрдЯрдмреБрдХ [рдЧреВрдЧрд▓ рдХреНрд▓рд╛рдЙрдб рдореЗрдореЛрд░реАрд╕реНрдЯреЛрд░ рдлреЙрд░ рд░реЗрдбрд┐рд╕](https://cloud.google.com/memorystore/docs/redis/memorystore-for-redis-overview) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЪреИрдЯ рд╕рдВрджреЗрд╢ рдЗрддрд┐рд╣рд╛рд╕ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `MemorystoreChatMessageHistory` рдХреНрд▓рд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рддрд╛ рд╣реИред

рдкреИрдХреЗрдЬ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [GitHub](https://github.com/googleapis/langchain-google-memorystore-redis-python/) рдкрд░ рдорд┐рд▓рддреА рд╣реИред

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/googleapis/langchain-google-memorystore-redis-python/blob/main/docs/chat_message_history.ipynb)

## рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ

рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрдп рдХрд░рдиреЗ рд╣реЛрдВрдЧреЗ:

* [рдПрдХ рдЧреВрдЧрд▓ рдХреНрд▓рд╛рдЙрдб рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдПрдВ](https://developers.google.com/workspace/guides/create-project)
* [рдореЗрдореЛрд░реАрд╕реНрдЯреЛрд░ рдлреЙрд░ рд░реЗрдбрд┐рд╕ API рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ](https://console.cloud.google.com/flows/enableapi?apiid=redis.googleapis.com)
* [рдПрдХ рдореЗрдореЛрд░реАрд╕реНрдЯреЛрд░ рдлреЙрд░ рд░реЗрдбрд┐рд╕ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдмрдирд╛рдПрдВ](https://cloud.google.com/memorystore/docs/redis/create-instance-console)ред рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╕рдВрд╕реНрдХрд░рдг 5.0 рдпрд╛ рдЙрд╕рд╕реЗ рдЕрдзрд┐рдХ рд╣реИред

рдбреЗрдЯрд╛рдмреЗрд╕ рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдХреЗ рд░рдирдЯрд╛рдЗрдо рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореВрд▓реНрдп рднрд░реЗрдВ рдФрд░ рдЙрджрд╛рд╣рд░рдг рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕реЗрд▓ рдЪрд▓рд╛рдПрдВред

```python
# @markdown Please specify an endpoint associated with the instance or demo purpose.
ENDPOINT = "redis://127.0.0.1:6379"  # @param {type:"string"}
```

### ЁЯжЬЁЯФЧ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди

рдПрдХреАрдХрд░рдг `langchain-google-memorystore-redis` рдкреИрдХреЗрдЬ рдореЗрдВ рдЕрдкрдиреЗ рдЖрдк рдореЗрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЗрд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

```python
%pip install -upgrade --quiet langchain-google-memorystore-redis
```

**Colab рдХреЗрд╡рд▓:** рдХрд░реНрдирд▓ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реЗрд▓ рдХреЛ рдЕрдирдХрдореЗрдВрдЯ рдХрд░реЗрдВ рдпрд╛ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдЯрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред Vertex AI Workbench рдХреЗ рд▓рд┐рдП, рд╢реАрд░реНрд╖ рдкрд░ рджрд┐рдП рдЧрдП рдмрдЯрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯрд░реНрдорд┐рдирд▓ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

```python
# # Automatically restart kernel after installs so that your environment can access the new packages
# import IPython

# app = IPython.Application.instance()
# app.kernel.do_shutdown(True)
```

### тШБ рдЕрдкрдиреЗ рдЧреВрдЧрд▓ рдХреНрд▓рд╛рдЙрдб рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╕реЗрдЯ рдХрд░реЗрдВ

рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдореЗрдВ рдЧреВрдЧрд▓ рдХреНрд▓рд╛рдЙрдб рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рдЧреВрдЧрд▓ рдХреНрд▓рд╛рдЙрдб рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдВред

рдпрджрд┐ рдЖрдк рдЕрдкрдиреЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЖрдИрдбреА рдХреЛ рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ, рддреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ:

* `gcloud config list` рдЪрд▓рд╛рдПрдВред
* `gcloud projects list` рдЪрд▓рд╛рдПрдВред
* рд╕рдорд░реНрдерди рдкреГрд╖реНрда рджреЗрдЦреЗрдВ: [рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЖрдИрдбреА рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ](https://support.google.com/googleapi/answer/7014113)ред

```python
# @markdown Please fill in the value below with your Google Cloud project ID and then run the cell.

PROJECT_ID = "my-project-id"  # @param {type:"string"}

# Set the project id
!gcloud config set project {PROJECT_ID}
```

### ЁЯФР рдкреНрд░рдорд╛рдгреАрдХрд░рдг

рдЧреВрдЧрд▓ рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд┐рдП рдЧрдП IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдк рдЕрдкрдиреЗ рдЧреВрдЧрд▓ рдХреНрд▓рд╛рдЙрдб рдкреНрд░реЛрдЬреЗрдХреНрдЯ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХреЗрдВред

* рдпрджрд┐ рдЖрдк рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП Colab рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд╕реЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЖрдЧреЗ рдмрдврд╝реЗрдВред
* рдпрджрд┐ рдЖрдк Vertex AI Workbench рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ [рдпрд╣рд╛рдВ](https://github.com/GoogleCloudPlatform/generative-ai/tree/main/setup-env) рджрд┐рдП рдЧрдП рд╕реЗрдЯрдЕрдк рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

```python
from google.colab import auth

auth.authenticate_user()
```

## рдореВрд▓рднреВрдд рдЙрдкрдпреЛрдЧ

### MemorystoreChatMessageHistory

`MemorystoreMessageHistory` рдХреНрд▓рд╛рд╕ рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдХреЗрд╡рд▓ 2 рдЪреАрдЬреЗрдВ рдкреНрд░рджрд╛рди рдХрд░рдиреА рд╣реЛрдВрдЧреА:

1. `redis_client` - рдПрдХ рдореЗрдореЛрд░реАрд╕реНрдЯреЛрд░ рд░реЗрдбрд┐рд╕ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдгред
1. `session_id` - рдкреНрд░рддреНрдпреЗрдХ рдЪреИрдЯ рд╕рдВрджреЗрд╢ рдЗрддрд┐рд╣рд╛рд╕ рд╡рд╕реНрддреБ рдХреЗ рдкрд╛рд╕ рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рд╕рддреНрд░ рдЖрдИрдбреА рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред рдпрджрд┐ рд╕рддреНрд░ рдЖрдИрдбреА рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд░реЗрдбрд┐рд╕ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╕рдВрджреЗрд╢ рд╣реИрдВ, рддреЛ рдЙрдиреНрд╣реЗрдВ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

```python
import redis
from langchain_google_memorystore_redis import MemorystoreChatMessageHistory

# Connect to a Memorystore for Redis instance
redis_client = redis.from_url("redis://127.0.0.1:6379")

message_history = MemorystoreChatMessageHistory(redis_client, session_id="session1")
```

```python
message_history.messages
```

#### рд╕рдлрд╛рдИ рдХрд░рдирд╛

рдЬрдм рдХрд┐рд╕реА рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рддреНрд░ рдХрд╛ рдЗрддрд┐рд╣рд╛рд╕ рдкреБрд░рд╛рдирд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╣рдЯрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**рдиреЛрдЯ:** рдПрдХ рдмрд╛рд░ рд╣рдЯрд╛ рджрд┐рдП рдЬрд╛рдиреЗ рдкрд░, рдбреЗрдЯрд╛ рдореЗрдореЛрд░реАрд╕реНрдЯреЛрд░ рдлреЙрд░ рд░реЗрдбрд┐рд╕ рдореЗрдВ рдирд╣реАрдВ рд░рд╣рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рд╕рджрд╛ рдХреЗ рд▓рд┐рдП рдЪрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред

```python
message_history.clear()
```
