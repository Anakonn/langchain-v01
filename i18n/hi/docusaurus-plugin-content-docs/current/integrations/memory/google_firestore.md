---
translated: true
---

# Google Firestore (рдиреЗрдЯрд┐рд╡ рдореЛрдб)

> [Google Cloud Firestore](https://cloud.google.com/firestore) рдПрдХ рд╕рд░реНрд╡рд░рд▓реЗрд╕ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝-рдЙрдиреНрдореБрдЦ рдбреЗрдЯрд╛рдмреЗрд╕ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рднреА рдорд╛рдВрдЧ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреЗрд▓ рдХрд░рддрд╛ рд╣реИред `Firestore рдХреЗ` Langchain рдПрдХреАрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ AI-рд╕рдВрдЪрд╛рд▓рд┐рдд рдЕрдиреБрднрд╡ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдХрд░реЗрдВред

рдпрд╣ рдиреЛрдЯрдмреБрдХ [Google Cloud Firestore](https://cloud.google.com/firestore) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЪреИрдЯ рд╕рдВрджреЗрд╢ рдЗрддрд┐рд╣рд╛рд╕ рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `FirestoreChatMessageHistory` рдХреНрд▓рд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рддрд╛ рд╣реИред

рдкреИрдХреЗрдЬ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [GitHub](https://github.com/googleapis/langchain-google-firestore-python/) рдкрд░ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/googleapis/langchain-google-firestore-python/blob/main/docs/chat_message_history.ipynb)

## рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ

рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрдп рдХрд░рдиреЗ рд╣реЛрдВрдЧреЗ:

* [рдПрдХ Google Cloud рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдПрдВ](https://developers.google.com/workspace/guides/create-project)
* [Firestore API рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ](https://console.cloud.google.com/flows/enableapi?apiid=firestore.googleapis.com)
* [рдПрдХ Firestore рдбреЗрдЯрд╛рдмреЗрд╕ рдмрдирд╛рдПрдВ](https://cloud.google.com/firestore/docs/manage-databases)

рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдХреЗ рд░рдирдЯрд╛рдЗрдо рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдбреЗрдЯрд╛рдмреЗрд╕ рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореВрд▓реНрдпреЛрдВ рдХреЛ рднрд░реЗрдВ рдФрд░ рдЙрджрд╛рд╣рд░рдг рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕реЗрд▓ рдЪрд▓рд╛рдПрдВред

### ЁЯжЬЁЯФЧ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди

рдПрдХреАрдХрд░рдг рдЕрдкрдиреЗ `langchain-google-firestore` рдкреИрдХреЗрдЬ рдореЗрдВ рдореМрдЬреВрдж рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЗрд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

```python
%pip install -upgrade --quiet langchain-google-firestore
```

**рдХреЗрд╡рд▓ Colab**: рдХрд░реНрдирд▓ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдВрдХрд┐рдд рд╕реЗрд▓ рдХреЛ рдЕрдирдХрдореЗрдВрдЯ рдХрд░реЗрдВ рдпрд╛ рдХрд░реНрдирд▓ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдЯрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред Vertex AI Workbench рдХреЗ рд▓рд┐рдП, рд╢реАрд░реНрд╖ рдкрд░ рджрд┐рдП рдЧрдП рдмрдЯрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯрд░реНрдорд┐рдирд▓ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

```python
# # Automatically restart kernel after installs so that your environment can access the new packages
# import IPython

# app = IPython.Application.instance()
# app.kernel.do_shutdown(True)
```

### тШБ рдЕрдкрдиреЗ Google Cloud рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдВ

рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдореЗрдВ Google Cloud рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ Google Cloud рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдВред

рдпрджрд┐ рдЖрдк рдЕрдкрдиреЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЖрдИрдбреА рдХреЛ рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ, рддреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ:

* `gcloud config list` рдЪрд▓рд╛рдПрдВред
* `gcloud projects list` рдЪрд▓рд╛рдПрдВред
* рд╕рдорд░реНрдерди рдкреГрд╖реНрда рджреЗрдЦреЗрдВ: [рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЖрдИрдбреА рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ](https://support.google.com/googleapi/answer/7014113)ред

```python
# @markdown Please fill in the value below with your Google Cloud project ID and then run the cell.

PROJECT_ID = "my-project-id"  # @param {type:"string"}

# Set the project id
!gcloud config set project {PROJECT_ID}
```

### ЁЯФР рдкреНрд░рдорд╛рдгреАрдХрд░рдг

рдЕрдкрдиреЗ Google Cloud рдкреНрд░реЛрдЬреЗрдХреНрдЯ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд┐рдП рдЧрдП IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ Google Cloud рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░реЗрдВред

- рдпрджрд┐ рдЖрдк рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП Colab рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд╕реЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЖрдЧреЗ рдмрдврд╝реЗрдВред
- рдпрджрд┐ рдЖрдк Vertex AI Workbench рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ [рдпрд╣рд╛рдВ](https://github.com/GoogleCloudPlatform/generative-ai/tree/main/setup-env) рджрд┐рдП рдЧрдП рд╕реЗрдЯрдЕрдк рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

```python
from google.colab import auth

auth.authenticate_user()
```

## рдореВрд▓рднреВрдд рдЙрдкрдпреЛрдЧ

### FirestoreChatMessageHistory

`FirestoreChatMessageHistory` рдХреНрд▓рд╛рд╕ рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдХреЗрд╡рд▓ 3 рдЪреАрдЬреЗрдВ рдкреНрд░рджрд╛рди рдХрд░рдиреА рд╣реЛрдВрдЧреА:

1. `session_id` - рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдЬреЛ рд╕рддреНрд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрдИрдбреА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИред
1. `collection`: Firestore рд╕рдВрдЧреНрд░рд╣ рдХрд╛ рдПрдХрд▓ `/`-рдбрд┐рд▓рд┐рдорд┐рдЯреЗрдб рдкрдеред

```python
from langchain_google_firestore import FirestoreChatMessageHistory

chat_history = FirestoreChatMessageHistory(
    session_id="user-session-id", collection="HistoryMessages"
)

chat_history.add_user_message("Hi!")
chat_history.add_ai_message("How can I help you?")
```

```python
chat_history.messages
```

#### рд╕рдлрд╛рдИ рдХрд░рдирд╛

рдЬрдм рдХрд┐рд╕реА рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рддреНрд░ рдХрд╛ рдЗрддрд┐рд╣рд╛рд╕ рдкреБрд░рд╛рдирд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдФрд░ рдореЗрдореЛрд░реА рд╕реЗ рд╣рдЯрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**рдиреЛрдЯ:** рдПрдХ рдмрд╛рд░ рд╣рдЯрд╛ рджрд┐рдП рдЬрд╛рдиреЗ рдкрд░, рдбреЗрдЯрд╛ Firestore рдореЗрдВ рдФрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдпрд╣ рд╕рджрд╛ рдХреЗ рд▓рд┐рдП рдЪрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред

```python
chat_history.clear()
```

### рдХрд╕реНрдЯрдо рдХреНрд▓рд╛рдЗрдВрдЯ

рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЙрдкрд▓рдмреНрдз рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред [рдХрд╕реНрдЯрдо рдХреНрд▓рд╛рдЗрдВрдЯ](https://cloud.google.com/python/docs/reference/firestore/latest/client) рдХреЛ рдирд┐рд░реНрдорд╛рддрд╛ рдХреЛ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

```python
from google.auth import compute_engine
from google.cloud import firestore

client = firestore.Client(
    project="project-custom",
    database="non-default-database",
    credentials=compute_engine.Credentials(),
)

history = FirestoreChatMessageHistory(
    session_id="session-id", collection="History", client=client
)

history.add_user_message("New message")

history.messages

history.clear()
```
