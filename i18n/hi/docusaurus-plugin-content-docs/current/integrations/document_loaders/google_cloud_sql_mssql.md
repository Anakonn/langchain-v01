---
translated: true
---

# Google Cloud SQL for SQL server

> [Cloud SQL](https://cloud.google.com/sql) рдПрдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рд░рд┐рд▓реЗрд╢рдирд▓ рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ рдЙрдЪреНрдЪ рдкреНрд░рджрд░реНрд╢рди, рд╕реБрдЪрд╛рд░реБ рдПрдХреАрдХрд░рдг рдФрд░ рдкреНрд░рднрд╛рд╡рд╢рд╛рд▓реА рд╕реНрдХреЗрд▓реЗрдмрд┐рд▓рд┐рдЯреА рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред рдпрд╣ [MySQL](https://cloud.google.com/sql/mysql), [PostgreSQL](https://cloud.google.com/sql/postgres) рдФрд░ [SQL Server](https://cloud.google.com/sql/sqlserver) рдбреЗрдЯрд╛рдмреЗрд╕ рдЗрдВрдЬрди рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред Cloud SQL рдХреЗ Langchain рдПрдХреАрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ AI-рд╕рдВрдЪрд╛рд▓рд┐рдд рдЕрдиреБрднрд╡ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдХрд░реЗрдВред

рдпрд╣ рдиреЛрдЯрдмреБрдХ [Cloud SQL for SQL server](https://cloud.google.com/sql/sqlserver) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ [Langchain рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реЛрдВ рдХреЛ рд╕рд╣реЗрдЬрдиреЗ, рд▓реЛрдб рдХрд░рдиреЗ рдФрд░ рд╣рдЯрд╛рдиреЗ](/docs/modules/data_connection/document_loaders/) рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ `MSSQLLoader` рдФрд░ `MSSQLDocumentSaver` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдкреИрдХреЗрдЬ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [GitHub](https://github.com/googleapis/langchain-google-cloud-sql-mssql-python/) рдкрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/googleapis/langchain-google-cloud-sql-mssql-python/blob/main/docs/document_loader.ipynb)

## рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ

рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрдп рдХрд░рдиреЗ рд╣реЛрдВрдЧреЗ:

* [рдПрдХ Google Cloud рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдПрдВ](https://developers.google.com/workspace/guides/create-project)
* [Cloud SQL Admin API рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВред](https://console.cloud.google.com/marketplace/product/google/sqladmin.googleapis.com)
* [Cloud SQL for SQL server рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдмрдирд╛рдПрдВ](https://cloud.google.com/sql/docs/sqlserver/create-instance)
* [Cloud SQL рдбреЗрдЯрд╛рдмреЗрд╕ рдмрдирд╛рдПрдВ](https://cloud.google.com/sql/docs/sqlserver/create-manage-databases)
* [рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдПрдХ IAM рдбреЗрдЯрд╛рдмреЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬреЛрдбрд╝реЗрдВ](https://cloud.google.com/sql/docs/sqlserver/create-manage-users) (рд╡реИрдХрд▓реНрдкрд┐рдХ)

рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдХреЗ рд░рдирдЯрд╛рдЗрдо рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдбреЗрдЯрд╛рдмреЗрд╕ рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореВрд▓реНрдпреЛрдВ рдХреЛ рднрд░реЗрдВ рдФрд░ рдЙрджрд╛рд╣рд░рдг рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕реЗрд▓ рдЪрд▓рд╛рдПрдВред

```python
# @markdown Please fill in the both the Google Cloud region and name of your Cloud SQL instance.
REGION = "us-central1"  # @param {type:"string"}
INSTANCE = "test-instance"  # @param {type:"string"}

# @markdown Please fill in user name and password of your Cloud SQL instance.
DB_USER = "sqlserver"  # @param {type:"string"}
DB_PASS = "password"  # @param {type:"string"}

# @markdown Please specify a database and a table for demo purpose.
DATABASE = "test"  # @param {type:"string"}
TABLE_NAME = "test-default"  # @param {type:"string"}
```

### ЁЯжЬЁЯФЧ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди

рдПрдХреАрдХрд░рдг `langchain-google-cloud-sql-mssql` рдкреИрдХреЗрдЬ рдореЗрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЗрд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

```python
%pip install --upgrade --quiet langchain-google-cloud-sql-mssql
```

**Colab рдХреЗрд╡рд▓**: рдХрд░реНрдирд▓ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реЗрд▓ рдХреЛ рдЕрдирдХрдореЗрдВрдЯ рдХрд░реЗрдВ рдпрд╛ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдЯрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред Vertex AI Workbench рдХреЗ рд▓рд┐рдП, рд╢реАрд░реНрд╖ рдкрд░ рджрд┐рдП рдЧрдП рдмрдЯрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯрд░реНрдорд┐рдирд▓ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

```python
# # Automatically restart kernel after installs so that your environment can access the new packages
# import IPython

# app = IPython.Application.instance()
# app.kernel.do_shutdown(True)
```

### ЁЯФР рдкреНрд░рдорд╛рдгреАрдХрд░рдг

рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд┐рдП рдЧрдП IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ Google Cloud рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдк рдЕрдкрдиреЗ Google Cloud рдкреНрд░реЛрдЬреЗрдХреНрдЯ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХреЗрдВред

- рдпрджрд┐ рдЖрдк рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП Colab рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд╕реЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЖрдЧреЗ рдмрдврд╝реЗрдВред
- рдпрджрд┐ рдЖрдк Vertex AI Workbench рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ [рдпрд╣рд╛рдВ](https://github.com/GoogleCloudPlatform/generative-ai/tree/main/setup-env) рджрд┐рдП рдЧрдП рд╕реЗрдЯрдЕрдк рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

```python
from google.colab import auth

auth.authenticate_user()
```

### тШБ рдЕрдкрдиреЗ Google Cloud рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╕реЗрдЯ рдХрд░реЗрдВ

рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдореЗрдВ Google Cloud рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ Google Cloud рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдВред

рдпрджрд┐ рдЖрдк рдЕрдкрдиреЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЖрдИрдбреА рдХреЛ рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ, рддреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ:

* `gcloud config list` рдЪрд▓рд╛рдПрдВред
* `gcloud projects list` рдЪрд▓рд╛рдПрдВред
* рд╕рд╣рд╛рдпрддрд╛ рдкреГрд╖реНрда рджреЗрдЦреЗрдВ: [рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЖрдИрдбреА рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ](https://support.google.com/googleapi/answer/7014113)ред

```python
# @markdown Please fill in the value below with your Google Cloud project ID and then run the cell.

PROJECT_ID = "my-project-id"  # @param {type:"string"}

# Set the project id
!gcloud config set project {PROJECT_ID}
```

### ЁЯТб API рд╕рдХреНрд╖рдорддрд╛

`langchain-google-cloud-sql-mssql` рдкреИрдХреЗрдЬ рдХреЗ рд▓рд┐рдП [Cloud SQL Admin API](https://console.cloud.google.com/flows/enableapi?apiid=sqladmin.googleapis.com) рдХреЛ рдЕрдкрдиреЗ Google Cloud рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред

```python
# enable Cloud SQL Admin API
!gcloud services enable sqladmin.googleapis.com
```

## рдореВрд▓рднреВрдд рдЙрдкрдпреЛрдЧ

### MSSQLEngine рдХрдиреЗрдХреНрд╢рди рдкреВрд▓

MSSQL рдЯреЗрдмрд▓ рд╕реЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕рд╣реЗрдЬрдиреЗ рдпрд╛ рд▓реЛрдб рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдореЗрдВ рдкрд╣рд▓реЗ Cloud SQL рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрдиреЗрдХреНрд╢рди рдкреВрд▓ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред `MSSQLEngine` [SQLAlchemy рдХрдиреЗрдХреНрд╢рди рдкреВрд▓](https://docs.sqlalchemy.org/en/20/core/pooling.html#module-sqlalchemy.pool) рдХреЛ рдЖрдкрдХреЗ Cloud SQL рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЖрдкрдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реЗ рд╕рдлрд▓ рдХрдиреЗрдХреНрд╢рди рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдЙрджреНрдпреЛрдЧ рдХреА рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рдкреНрд░рдерд╛рдУрдВ рдХрд╛ рдкрд╛рд▓рди рд╣реЛрддрд╛ рд╣реИред

`MSSQLEngine.from_instance()` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ `MSSQLEngine` рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдХреЗрд╡рд▓ 4 рдЪреАрдЬрд╝реЗрдВ рдкреНрд░рджрд╛рди рдХрд░рдиреА рд╣реЛрдВрдЧреА:

1. `project_id`: Cloud SQL рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕реНрдерд┐рдд Google Cloud рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЖрдИрдбреАред
1. `region`: Cloud SQL рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕реНрдерд┐рдд рдХреНрд╖реЗрддреНрд░ред
1. `instance`: Cloud SQL рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХрд╛ рдирд╛рдоред
1. `database`: Cloud SQL рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд░ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд╛ рдирд╛рдоред
1. `user`: рдбреЗрдЯрд╛рдмреЗрд╕ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рд▓реЙрдЧрд┐рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ред
1. `password`: рдбреЗрдЯрд╛рдмреЗрд╕ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рд▓реЙрдЧрд┐рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдкрд╛рд╕рд╡рд░реНрдбред

```python
from langchain_google_cloud_sql_mssql import MSSQLEngine

engine = MSSQLEngine.from_instance(
    project_id=PROJECT_ID,
    region=REGION,
    instance=INSTANCE,
    database=DATABASE,
    user=DB_USER,
    password=DB_PASS,
)
```

### рдПрдХ рдЯреЗрдмрд▓ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░реЗрдВ

`MSSQLEngine.init_document_table(<table_name>)` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдХреАрдорд╛ рд╡рд╛рд▓реЗ рдПрдХ рдЯреЗрдмрд▓ рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░реЗрдВред рдЯреЗрдмрд▓ рдХреЙрд▓рдо:

- page_content (рдкреНрд░рдХрд╛рд░: text)
- langchain_metadata (рдкреНрд░рдХрд╛рд░: JSON)

`overwrite_existing=True` рдлреНрд▓реИрдЧ рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдирдП рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдЯреЗрдмрд▓ рд╕реЗ рдХрд┐рд╕реА рдореМрдЬреВрджрд╛ рд╕рдорд╛рди рдирд╛рдо рд╡рд╛рд▓реЗ рдЯреЗрдмрд▓ рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

```python
engine.init_document_table(TABLE_NAME, overwrite_existing=True)
```

### рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕рд╣реЗрдЬреЗрдВ

`MSSQLDocumentSaver.add_documents(<documents>)` рдХреЗ рд╕рд╛рде Langchain рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕рд╣реЗрдЬреЗрдВред `MSSQLDocumentSaver` рдХреНрд▓рд╛рд╕ рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ 2 рдЪреАрдЬрд╝реЗрдВ рдкреНрд░рджрд╛рди рдХрд░рдиреА рд╣реЛрдВрдЧреА:

1. `engine` - рдПрдХ `MSSQLEngine` рдЗрдВрдЬрди рдХрд╛ рдПрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ред
2. `table_name` - Cloud SQL рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ Langchain рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреЗрдмрд▓ рдХрд╛ рдирд╛рдоред

```python
from langchain_core.documents import Document
from langchain_google_cloud_sql_mssql import MSSQLDocumentSaver

test_docs = [
    Document(
        page_content="Apple Granny Smith 150 0.99 1",
        metadata={"fruit_id": 1},
    ),
    Document(
        page_content="Banana Cavendish 200 0.59 0",
        metadata={"fruit_id": 2},
    ),
    Document(
        page_content="Orange Navel 80 1.29 1",
        metadata={"fruit_id": 3},
    ),
]
saver = MSSQLDocumentSaver(engine=engine, table_name=TABLE_NAME)
saver.add_documents(test_docs)
```

### рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд▓реЛрдб рдХрд░реЗрдВ

`MSSQLLoader.load()` рдпрд╛ `MSSQLLoader.lazy_load()` рдХреЗ рд╕рд╛рде Langchain рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд▓реЛрдб рдХрд░реЗрдВред `lazy_load` рдПрдХ рдЬрдирд░реЗрдЯрд░ рд▓реМрдЯрд╛рддрд╛ рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рдЗрдЯрд░реЗрд╢рди рдХреЗ рджреМрд░рд╛рди рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдкреНрд░рд╢реНрди рдХрд░рддрд╛ рд╣реИред `MSSQLDocumentSaver` рдХреНрд▓рд╛рд╕ рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

1. `engine` - рдПрдХ `MSSQLEngine` рдЗрдВрдЬрди рдХрд╛ рдПрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ред
2. `table_name` - Cloud SQL рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ Langchain рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреЗрдмрд▓ рдХрд╛ рдирд╛рдоред

```python
from langchain_google_cloud_sql_mssql import MSSQLLoader

loader = MSSQLLoader(engine=engine, table_name=TABLE_NAME)
docs = loader.lazy_load()
for doc in docs:
    print("Loaded documents:", doc)
```

### рдбреЙрдХреНрдпреВрдореЗрдВрдЯреНрд╕ рдХреЛ рдХреНрд╡реЗрд░реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЛрдб рдХрд░реЗрдВ

рдЯреЗрдмрд▓ рд╕реЗ рдбреЙрдХреНрдпреВрдореЗрдВрдЯреНрд╕ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо SQL рдХреНрд╡реЗрд░реА рд╕реЗ рдЙрддреНрдкрдиреНрди рд╡реНрдпреВ рд╕реЗ рднреА рдбреЙрдХреНрдпреВрдореЗрдВрдЯреНрд╕ рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

```python
from langchain_google_cloud_sql_mssql import MSSQLLoader

loader = MSSQLLoader(
    engine=engine,
    query=f"select * from \"{TABLE_NAME}\" where JSON_VALUE(langchain_metadata, '$.fruit_id') = 1;",
)
onedoc = loader.load()
onedoc
```

SQL рдХреНрд╡реЗрд░реА рд╕реЗ рдЙрддреНрдкрдиреНрди рд╡реНрдпреВ рдХрд╛ рд╕реНрдХреАрдорд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЯреЗрдмрд▓ рд╕реЗ рдЕрд▓рдЧ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдРрд╕реЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, MSSQLLoader рдХрд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рдЧреИрд░-рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдХреАрдорд╛ рд╡рд╛рд▓реЗ рдЯреЗрдмрд▓ рд╕реЗ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд╕рдорд╛рди рд╣реЛрддрд╛ рд╣реИред рдХреГрдкрдпрд╛ [рдЕрдиреБрдХреВрд▓рд┐рдд рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкреГрд╖реНрда рд╕рд╛рдордЧреНрд░реА рдФрд░ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд▓реЛрдб рдХрд░реЗрдВ](#Load-documents-with-customized-document-page-content-&-metadata) рдЦрдВрдб рджреЗрдЦреЗрдВред

### рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╣рдЯрд╛рдПрдВ

`MSSQLDocumentSaver.delete(<documents>)` рдХреЗ рд╕рд╛рде MSSQL рдЯреЗрдмрд▓ рд╕реЗ рдПрдХ рд╕реВрдЪреА рдХреЗ langchain рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╣рдЯрд╛рдПрдВред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдХреАрдорд╛ (page_content, langchain_metadata) рд╡рд╛рд▓реЗ рдЯреЗрдмрд▓ рдХреЗ рд▓рд┐рдП, рд╣рдЯрд╛рдиреЗ рдХрд╛ рдорд╛рдирджрдВрдб рд╣реИ:

рдПрдХ `рдкрдВрдХреНрддрд┐` рддрдм рд╣рдЯрд╛рдИ рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП рдЬрдм рдПрдХ `рджрд╕реНрддрд╛рд╡реЗрдЬрд╝` рд╕реВрдЪреА рдореЗрдВ рдореМрдЬреВрдж рд╣реЛ, рдЬрд╣рд╛рдВ

- `document.page_content` рдмрд░рд╛рдмрд░ рд╣реИ `рдкрдВрдХреНрддрд┐[page_content]`
- `document.metadata` рдмрд░рд╛рдмрд░ рд╣реИ `рдкрдВрдХреНрддрд┐[langchain_metadata]`

```python
from langchain_google_cloud_sql_mssql import MSSQLLoader

loader = MSSQLLoader(engine=engine, table_name=TABLE_NAME)
docs = loader.load()
print("Documents before delete:", docs)
saver.delete(onedoc)
print("Documents after delete:", loader.load())
```

## рдЙрдиреНрдирдд рдЙрдкрдпреЛрдЧ

### рдЕрдиреБрдХреВрд▓рд┐рдд рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкреГрд╖реНрда рд╕рд╛рдордЧреНрд░реА рдФрд░ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд▓реЛрдб рдХрд░реЗрдВ

рдкрд╣рд▓реЗ рд╣рдо рдЧреИрд░-рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдХреАрдорд╛ рд╡рд╛рд▓реЗ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдЯреЗрдмрд▓ рддреИрдпрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдХреБрдЫ рдордирдорд╛рдиреЗ рдбреЗрдЯрд╛ рд╕реЗ рднрд░ рджреЗрддреЗ рд╣реИрдВред

```python
import sqlalchemy

with engine.connect() as conn:
    conn.execute(sqlalchemy.text(f'DROP TABLE IF EXISTS "{TABLE_NAME}"'))
    conn.commit()
    conn.execute(
        sqlalchemy.text(
            f"""
            IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[{TABLE_NAME}]') AND type in (N'U'))
                BEGIN
                    CREATE TABLE [dbo].[{TABLE_NAME}](
                        fruit_id INT IDENTITY(1,1) PRIMARY KEY,
                        fruit_name VARCHAR(100) NOT NULL,
                        variety VARCHAR(50),
                        quantity_in_stock INT NOT NULL,
                        price_per_unit DECIMAL(6,2) NOT NULL,
                        organic BIT NOT NULL
                    )
                END
            """
        )
    )
    conn.execute(
        sqlalchemy.text(
            f"""
            INSERT INTO "{TABLE_NAME}" (fruit_name, variety, quantity_in_stock, price_per_unit, organic)
            VALUES
                ('Apple', 'Granny Smith', 150, 0.99, 1),
                ('Banana', 'Cavendish', 200, 0.59, 0),
                ('Orange', 'Navel', 80, 1.29, 1);
            """
        )
    )
    conn.commit()
```

рдпрджрд┐ рд╣рдо рдЕрднреА рднреА рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдЯреЗрдмрд▓ рд╕реЗ `MSSQLLoader` рдХреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде langchain рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд▓реЛрдб рдХрд┐рдП рдЧрдП рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реЛрдВ рдХрд╛ `page_content` рдЯреЗрдмрд▓ рдХрд╛ рдкрд╣рд▓рд╛ рдХреЙрд▓рдо рд╣реЛрдЧрд╛, рдФрд░ `metadata` рд╕рднреА рдЕрдиреНрдп рдХреЙрд▓рдореЛрдВ рдХреЗ рдХреАрдп-рдореВрд▓реНрдп рдпреБрдЧреНрдореЛрдВ рд╕реЗ рдмрдиреЗрдЧрд╛ред

```python
loader = MSSQLLoader(
    engine=engine,
    table_name=TABLE_NAME,
)
loader.load()
```

рд╣рдо `MSSQLLoader` рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рддреЗ рд╕рдордп `content_columns` рдФрд░ `metadata_columns` рд╕реЗрдЯ рдХрд░рдХреЗ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд╛рдВрдЫрд┐рдд рд╕рд╛рдордЧреНрд░реА рдФрд░ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

1. `content_columns`: рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЗ `page_content` рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓рдоред
2. `metadata_columns`: рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЗ `metadata` рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓рдоред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдВ, `content_columns` рдореЗрдВ рдХреЙрд▓рдореЛрдВ рдХреЗ рдорд╛рди рдХреЛ рдПрдХ рд╕реНрдкреЗрд╕-рдЕрд▓рдЧ рдХрд┐рдпрд╛ рд╣реБрдЖ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛, рдЬреЛ рд▓реЛрдб рдХрд┐рдП рдЧрдП рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реЛрдВ рдХрд╛ `page_content` рд╣реЛрдЧрд╛, рдФрд░ `metadata` рдореЗрдВ рдХреЗрд╡рд▓ `metadata_columns` рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреЙрд▓рдореЛрдВ рдХреЗ рдХреАрдп-рдореВрд▓реНрдп рдпреБрдЧреНрдо рд╣реЛрдВрдЧреЗред

```python
loader = MSSQLLoader(
    engine=engine,
    table_name=TABLE_NAME,
    content_columns=[
        "variety",
        "quantity_in_stock",
        "price_per_unit",
        "organic",
    ],
    metadata_columns=["fruit_id", "fruit_name"],
)
loader.load()
```

### рдЕрдиреБрдХреВрд▓рд┐рдд рдкреГрд╖реНрда рд╕рд╛рдордЧреНрд░реА рдФрд░ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕рд╣реЗрдЬреЗрдВ

рдЕрдиреБрдХреВрд▓рд┐рдд рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдлрд╝реАрд▓реНрдб рд╡рд╛рд▓реЗ рдЯреЗрдмрд▓ рдореЗрдВ langchain рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕рд╣реЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдкрд╣рд▓реЗ `MSSQLEngine.init_document_table()` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдРрд╕рд╛ рдЯреЗрдмрд▓ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛, рдФрд░ рд╣рдо рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЗрд╕рдореЗрдВ `metadata_columns` рдХреА рд╕реВрдЪреА рд╣реЛред рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдЯреЗрдмрд▓ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЯреЗрдмрд▓ рдХреЙрд▓рдо рд╣реЛрдВрдЧреЗ:

- description (type: text): рдлрд▓ рдХрд╛ рд╡рд┐рд╡рд░рдг рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
- fruit_name (type text): рдлрд▓ рдХрд╛ рдирд╛рдо рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
- organic (type tinyint(1)): рдпрд╣ рдмрддрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдлрд▓ рдЬреИрд╡рд┐рдХ рд╣реИред
- other_metadata (type: JSON): рдлрд▓ рдХреЗ рдЕрдиреНрдп рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

рд╣рдо `MSSQLEngine.init_document_table()` рдХреЗ рд╕рд╛рде рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЯреЗрдмрд▓ рдмрдирд╛ рд╕рдХреЗрдВ:

1. `table_name`: Cloud SQL рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ langchain рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреЗрдмрд▓ рдХрд╛ рдирд╛рдоред
2. `metadata_columns`: рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЙрд▓рдо рдХреА рд╕реВрдЪреА `sqlalchemy.Column` рдмрддрд╛рддреА рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдореЗрдВ рдЪрд╛рд╣рд┐рдПред
3. `content_column`: langchain рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЗ `page_content` рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓рдо рдХрд╛ рдирд╛рдоред рдбрд┐рдлрд╝реЙрд▓реНрдЯ: `page_content`ред
4. `metadata_json_column`: langchain рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд `metadata` рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП JSON рдХреЙрд▓рдо рдХрд╛ рдирд╛рдоред рдбрд┐рдлрд╝реЙрд▓реНрдЯ: `langchain_metadata`ред

```python
engine.init_document_table(
    TABLE_NAME,
    metadata_columns=[
        sqlalchemy.Column(
            "fruit_name",
            sqlalchemy.UnicodeText,
            primary_key=False,
            nullable=True,
        ),
        sqlalchemy.Column(
            "organic",
            sqlalchemy.Boolean,
            primary_key=False,
            nullable=True,
        ),
    ],
    content_column="description",
    metadata_json_column="other_metadata",
    overwrite_existing=True,
)
```

`MSSQLDocumentSaver.add_documents(<documents>)` рдХреЗ рд╕рд╛рде рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕рд╣реЗрдЬреЗрдВред рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ,

- `document.page_content` рдХреЛ `description` рдХреЙрд▓рдо рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ред
- `document.metadata.fruit_name` рдХреЛ `fruit_name` рдХреЙрд▓рдо рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ред
- `document.metadata.organic` рдХреЛ `organic` рдХреЙрд▓рдо рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ред
- `document.metadata.fruit_id` рдХреЛ JSON рдкреНрд░рд╛рд░реВрдк рдореЗрдВ `other_metadata` рдХреЙрд▓рдо рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ред

```python
test_docs = [
    Document(
        page_content="Granny Smith 150 0.99",
        metadata={"fruit_id": 1, "fruit_name": "Apple", "organic": 1},
    ),
]
saver = MSSQLDocumentSaver(
    engine=engine,
    table_name=TABLE_NAME,
    content_column="description",
    metadata_json_column="other_metadata",
)
saver.add_documents(test_docs)
```

```python
with engine.connect() as conn:
    result = conn.execute(sqlalchemy.text(f'select * from "{TABLE_NAME}";'))
    print(result.keys())
    print(result.fetchall())
```

### рдЕрдиреБрдХреВрд▓рд┐рдд рдкреГрд╖реНрда рд╕рд╛рдордЧреНрд░реА рдФрд░ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╣рдЯрд╛рдПрдВ

рд╣рдо `MSSQLDocumentSaver.delete(<documents>)` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдиреБрдХреВрд▓рд┐рдд рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЙрд▓рдо рд╡рд╛рд▓реЗ рдЯреЗрдмрд▓ рд╕реЗ рднреА рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВред рд╣рдЯрд╛рдиреЗ рдХрд╛ рдорд╛рдирджрдВрдб рд╣реИ:

рдПрдХ `рдкрдВрдХреНрддрд┐` рддрдм рд╣рдЯрд╛рдИ рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП рдЬрдм рдПрдХ `рджрд╕реНрддрд╛рд╡реЗрдЬрд╝` рд╕реВрдЪреА рдореЗрдВ рдореМрдЬреВрдж рд╣реЛ, рдЬрд╣рд╛рдВ

- `document.page_content` рдмрд░рд╛рдмрд░ рд╣реИ `рдкрдВрдХреНрддрд┐[page_content]`
- рдкреНрд░рддреНрдпреЗрдХ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдлрд╝реАрд▓реНрдб `k` рдХреЗ рд▓рд┐рдП `document.metadata`
    - `document.metadata[k]` рдмрд░рд╛рдмрд░ рд╣реИ `рдкрдВрдХреНрддрд┐[k]` рдпрд╛ `document.metadata[k]` рдмрд░рд╛рдмрд░ рд╣реИ `рдкрдВрдХреНрддрд┐[langchain_metadata][k]`
- `document.metadata` рдореЗрдВ рдореМрдЬреВрдж рди рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдХреЛрдИ рдЕрддрд┐рд░рд┐рдХреНрдд рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдлрд╝реАрд▓реНрдб `рдкрдВрдХреНрддрд┐` рдореЗрдВ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИред

```python
loader = MSSQLLoader(engine=engine, table_name=TABLE_NAME)
docs = loader.load()
print("Documents before delete:", docs)
saver.delete(docs)
print("Documents after delete:", loader.load())
```
