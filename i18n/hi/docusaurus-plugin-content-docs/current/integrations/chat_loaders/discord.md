---
translated: true
---

‡§Ø‡§π ‡§®‡•ã‡§ü‡§¨‡•Å‡§ï ‡§¶‡§ø‡§ñ‡§æ‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§Ü‡§™ ‡§Ö‡§™‡§®‡§æ ‡§∏‡•ç‡§µ‡§Ø‡§Ç ‡§ï‡§æ ‡§ö‡•à‡§ü ‡§≤‡•ã‡§°‡§∞ ‡§ï‡•à‡§∏‡•á ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§ï‡•â‡§™‡•Ä-‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§ø‡§è ‡§ó‡§è ‡§∏‡§Ç‡§¶‡•á‡§∂‡•ã‡§Ç (‡§°‡•Ä‡§è‡§Æ‡§è‡§∏ ‡§∏‡•á) ‡§ï‡•ã LangChain ‡§∏‡§Ç‡§¶‡•á‡§∂‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§

‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§Æ‡•á‡§Ç ‡§ö‡§æ‡§∞ ‡§ö‡§∞‡§£ ‡§π‡•à‡§Ç:
1. ‡§°‡§ø‡§∏‡•ç‡§ï‡•â‡§∞‡•ç‡§° ‡§ê‡§™ ‡§∏‡•á ‡§ö‡•à‡§ü ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§ï‡•á ‡§î‡§∞ ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§Ö‡§™‡§®‡•á ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§ï‡§Ç‡§™‡•ç‡§Ø‡•Ç‡§ü‡§∞ ‡§™‡§∞ ‡§´‡§º‡§æ‡§á‡§≤ ‡§Æ‡•á‡§Ç ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡§ï‡•á ‡§ö‡•à‡§ü .txt ‡§´‡§º‡§æ‡§á‡§≤ ‡§¨‡§®‡§æ‡§è‡§Ç
2. ‡§®‡•Ä‡§ö‡•á ‡§¶‡§ø‡§è ‡§ó‡§è ‡§ö‡•à‡§ü ‡§≤‡•ã‡§°‡§∞ ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§æ ‡§ï‡•ã ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§´‡§º‡§æ‡§á‡§≤ ‡§Æ‡•á‡§Ç ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç‡•§
3. `DiscordChatLoader` ‡§ï‡•ã ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•á ‡§™‡§• ‡§ï‡•á ‡§∏‡§æ‡§• ‡§á‡§®‡§ø‡§∂‡§ø‡§Ø‡§≤‡§æ‡§á‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç‡•§
4. ‡§∞‡•Ç‡§™‡§æ‡§Ç‡§§‡§∞‡§£ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è `loader.load()` (‡§Ø‡§æ `loader.lazy_load()`) ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç‡•§

## 1. ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§°‡§Ç‡§™ ‡§¨‡§®‡§æ‡§è‡§Ç

‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç (2023/08/23) ‡§Ø‡§π ‡§≤‡•ã‡§°‡§∞ ‡§ï‡•á‡§µ‡§≤ ‡§ê‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§¶‡•á‡§∂‡•ã‡§Ç ‡§ï‡•ã ‡§ï‡•ç‡§≤‡§ø‡§™‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§ï‡•á ‡§î‡§∞ ‡§è‡§ï ‡§´‡§º‡§æ‡§á‡§≤ ‡§Æ‡•á‡§Ç ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡§ï‡•á ‡§ú‡§®‡§∞‡•á‡§ü ‡§ï‡•Ä ‡§ó‡§à .txt ‡§´‡§º‡§æ‡§á‡§≤‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§®‡•Ä‡§ö‡•á ‡§è‡§ï ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§

```python
%%writefile discord_chats.txt
talkingtower ‚Äî 08/15/2023 11:10 AM
Love music! Do you like jazz?
reporterbob ‚Äî 08/15/2023 9:27 PM
Yes! Jazz is fantastic. Ever heard this one?
Website
Listen to classic jazz track...

talkingtower ‚Äî Yesterday at 5:03 AM
Indeed! Great choice. üé∑
reporterbob ‚Äî Yesterday at 5:23 AM
Thanks! How about some virtual sightseeing?
Website
Virtual tour of famous landmarks...

talkingtower ‚Äî Today at 2:38 PM
Sounds fun! Let's explore.
reporterbob ‚Äî Today at 2:56 PM
Enjoy the tour! See you around.
talkingtower ‚Äî Today at 3:00 PM
Thank you! Goodbye! üëã
reporterbob ‚Äî Today at 3:02 PM
Farewell! Happy exploring.
```

```output
Writing discord_chats.txt
```

## 2. ‡§ö‡•à‡§ü ‡§≤‡•ã‡§°‡§∞ ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç

```python
import logging
import re
from typing import Iterator, List

from langchain_community.chat_loaders import base as chat_loaders
from langchain_core.messages import BaseMessage, HumanMessage

logger = logging.getLogger()


class DiscordChatLoader(chat_loaders.BaseChatLoader):
    def __init__(self, path: str):
        """
        Initialize the Discord chat loader.

        Args:
            path: Path to the exported Discord chat text file.
        """
        self.path = path
        self._message_line_regex = re.compile(
            r"(.+?) ‚Äî (\w{3,9} \d{1,2}(?:st|nd|rd|th)?(?:, \d{4})? \d{1,2}:\d{2} (?:AM|PM)|Today at \d{1,2}:\d{2} (?:AM|PM)|Yesterday at \d{1,2}:\d{2} (?:AM|PM))",  # noqa
            flags=re.DOTALL,
        )

    def _load_single_chat_session_from_txt(
        self, file_path: str
    ) -> chat_loaders.ChatSession:
        """
        Load a single chat session from a text file.

        Args:
            file_path: Path to the text file containing the chat messages.

        Returns:
            A `ChatSession` object containing the loaded chat messages.
        """
        with open(file_path, "r", encoding="utf-8") as file:
            lines = file.readlines()

        results: List[BaseMessage] = []
        current_sender = None
        current_timestamp = None
        current_content = []
        for line in lines:
            if re.match(
                r".+? ‚Äî (\d{2}/\d{2}/\d{4} \d{1,2}:\d{2} (?:AM|PM)|Today at \d{1,2}:\d{2} (?:AM|PM)|Yesterday at \d{1,2}:\d{2} (?:AM|PM))",  # noqa
                line,
            ):
                if current_sender and current_content:
                    results.append(
                        HumanMessage(
                            content="".join(current_content).strip(),
                            additional_kwargs={
                                "sender": current_sender,
                                "events": [{"message_time": current_timestamp}],
                            },
                        )
                    )
                current_sender, current_timestamp = line.split(" ‚Äî ")[:2]
                current_content = [
                    line[len(current_sender) + len(current_timestamp) + 4 :].strip()
                ]
            elif re.match(r"\[\d{1,2}:\d{2} (?:AM|PM)\]", line.strip()):
                results.append(
                    HumanMessage(
                        content="".join(current_content).strip(),
                        additional_kwargs={
                            "sender": current_sender,
                            "events": [{"message_time": current_timestamp}],
                        },
                    )
                )
                current_timestamp = line.strip()[1:-1]
                current_content = []
            else:
                current_content.append("\n" + line.strip())

        if current_sender and current_content:
            results.append(
                HumanMessage(
                    content="".join(current_content).strip(),
                    additional_kwargs={
                        "sender": current_sender,
                        "events": [{"message_time": current_timestamp}],
                    },
                )
            )

        return chat_loaders.ChatSession(messages=results)

    def lazy_load(self) -> Iterator[chat_loaders.ChatSession]:
        """
        Lazy load the messages from the chat file and yield them in the required format.

        Yields:
            A `ChatSession` object containing the loaded chat messages.
        """
        yield self._load_single_chat_session_from_txt(self.path)
```

## 2. ‡§≤‡•ã‡§°‡§∞ ‡§¨‡§®‡§æ‡§è‡§Ç

‡§π‡§Æ ‡§â‡§∏ ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•Ä ‡§ì‡§∞ ‡§á‡§∂‡§æ‡§∞‡§æ ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á ‡§ú‡§ø‡§∏‡•á ‡§π‡§Æ‡§®‡•á ‡§Ö‡§≠‡•Ä ‡§°‡§ø‡§∏‡•ç‡§ï ‡§™‡§∞ ‡§≤‡§ø‡§ñ‡§æ ‡§π‡•à‡•§

```python
loader = DiscordChatLoader(
    path="./discord_chats.txt",
)
```

## 3. ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç

‡§Ø‡§¶‡§ø ‡§∏‡•ç‡§µ‡§∞‡•Ç‡§™ ‡§∏‡§π‡•Ä ‡§π‡•à, ‡§§‡•ã ‡§≤‡•ã‡§°‡§∞ ‡§ö‡•à‡§ü ‡§ï‡•ã langchain ‡§∏‡§Ç‡§¶‡•á‡§∂‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∞‡•Ç‡§™‡§æ‡§Ç‡§§‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§ó‡§æ‡•§

```python
from typing import List

from langchain_community.chat_loaders.utils import (
    map_ai_messages,
    merge_chat_runs,
)
from langchain_core.chat_sessions import ChatSession

raw_messages = loader.lazy_load()
# Merge consecutive messages from the same sender into a single message
merged_messages = merge_chat_runs(raw_messages)
# Convert messages from "talkingtower" to AI messages
messages: List[ChatSession] = list(
    map_ai_messages(merged_messages, sender="talkingtower")
)
```

```python
messages
```

```output
[{'messages': [AIMessage(content='Love music! Do you like jazz?', additional_kwargs={'sender': 'talkingtower', 'events': [{'message_time': '08/15/2023 11:10 AM\n'}]}),
   HumanMessage(content='Yes! Jazz is fantastic. Ever heard this one?\nWebsite\nListen to classic jazz track...', additional_kwargs={'sender': 'reporterbob', 'events': [{'message_time': '08/15/2023 9:27 PM\n'}]}),
   AIMessage(content='Indeed! Great choice. üé∑', additional_kwargs={'sender': 'talkingtower', 'events': [{'message_time': 'Yesterday at 5:03 AM\n'}]}),
   HumanMessage(content='Thanks! How about some virtual sightseeing?\nWebsite\nVirtual tour of famous landmarks...', additional_kwargs={'sender': 'reporterbob', 'events': [{'message_time': 'Yesterday at 5:23 AM\n'}]}),
   AIMessage(content="Sounds fun! Let's explore.", additional_kwargs={'sender': 'talkingtower', 'events': [{'message_time': 'Today at 2:38 PM\n'}]}),
   HumanMessage(content='Enjoy the tour! See you around.', additional_kwargs={'sender': 'reporterbob', 'events': [{'message_time': 'Today at 2:56 PM\n'}]}),
   AIMessage(content='Thank you! Goodbye! üëã', additional_kwargs={'sender': 'talkingtower', 'events': [{'message_time': 'Today at 3:00 PM\n'}]}),
   HumanMessage(content='Farewell! Happy exploring.', additional_kwargs={'sender': 'reporterbob', 'events': [{'message_time': 'Today at 3:02 PM\n'}]})]}]
```

### ‡§Ö‡§ó‡§≤‡•á ‡§ï‡§¶‡§Æ

‡§Ü‡§™ ‡§á‡§® ‡§∏‡§Ç‡§¶‡•á‡§∂‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§Ö‡§™‡§®‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§ú‡•à‡§∏‡•á ‡§Æ‡•â‡§°‡§≤ ‡§ï‡•ã ‡§´‡§º‡§æ‡§á‡§®-‡§ü‡•ç‡§Ø‡•Ç‡§® ‡§ï‡§∞‡§®‡§æ, ‡§ï‡•Å‡§õ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ö‡•Å‡§®‡§®‡§æ, ‡§Ø‡§æ ‡§∏‡•Ä‡§ß‡•á ‡§Ö‡§ó‡§≤‡•á ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§ï‡§∞‡§®‡§æ‡•§

```python
from langchain_openai import ChatOpenAI

llm = ChatOpenAI()

for chunk in llm.stream(messages[0]["messages"]):
    print(chunk.content, end="", flush=True)
```

```output
Thank you! Have a great day!
```
