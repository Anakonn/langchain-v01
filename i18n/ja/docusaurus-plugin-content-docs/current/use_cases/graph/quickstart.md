---
sidebar_position: 0
translated: true
---

# ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸Šã§Q&Aãƒã‚§ãƒ¼ãƒ³ã‚’ä½œæˆã™ã‚‹åŸºæœ¬çš„ãªæ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ã†ã¨ã€ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦è³ªå•ã—ã€è‡ªç„¶è¨€èªã§å›ç­”ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹æ³¨æ„ âš ï¸

ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®Q&Aã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ã«ã¯ã€ãƒ¢ãƒ‡ãƒ«ç”Ÿæˆã®ã‚°ãƒ©ãƒ•ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã¯å›ºæœ‰ã®ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæ¨©é™ã¯å¸¸ã«ãƒã‚§ãƒ¼ãƒ³/ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ‹ãƒ¼ã‚ºã«åˆã‚ã›ã¦å¯èƒ½ãªé™ã‚Šç‹­ã„ç¯„å›²ã«åˆ¶é™ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¢ãƒ‡ãƒ«ãƒ‰ãƒªãƒ–ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ãƒªã‚¹ã‚¯ã‚’è»½æ¸›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¸€èˆ¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«ã¤ã„ã¦ã¯ã€[ã“ã¡ã‚‰](/docs/security)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ä¸€èˆ¬çš„ãªã‚°ãƒ©ãƒ•ãƒã‚§ãƒ¼ãƒ³ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™:

1. **è³ªå•ã‚’ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã«å¤‰æ›**: ãƒ¢ãƒ‡ãƒ«ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒª(Cypherãªã©)ã«å¤‰æ›ã—ã¾ã™ã€‚
2. **ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œ**: ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
3. **è³ªå•ã«å›ç­”**: ã‚¯ã‚¨ãƒªçµæœã‚’ä½¿ã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã«å›ç­”ã—ã¾ã™ã€‚

![sql_usecase.png](../../../../../../static/img/graph_usecase.png)

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ã¾ãšã€å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚
ã“ã®ä¾‹ã§ã¯ã€Neo4jã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```python
%pip install --upgrade --quiet  langchain langchain-community langchain-openai neo4j
```

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§OpenAIãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```python
import getpass
import os

os.environ["OPENAI_API_KEY"] = getpass.getpass()

# Uncomment the below to use LangSmith. Not required.
# os.environ["LANGCHAIN_API_KEY"] = getpass.getpass()
# os.environ["LANGCHAIN_TRACING_V2"] = "true"
```

```output
 Â·Â·Â·Â·Â·Â·Â·Â·
```

æ¬¡ã«ã€Neo4jã®è³‡æ ¼æƒ…å ±ã‚’å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
[ã“ã‚Œã‚‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †](https://neo4j.com/docs/operations-manual/current/installation/)ã«å¾“ã£ã¦Neo4jãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚

```python
os.environ["NEO4J_URI"] = "bolt://localhost:7687"
os.environ["NEO4J_USERNAME"] = "neo4j"
os.environ["NEO4J_PASSWORD"] = "password"
```

ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€Neo4jãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã—ã€æ˜ ç”»ã¨ãã®å‡ºæ¼”è€…ã«é–¢ã™ã‚‹ä¾‹ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

```python
from langchain_community.graphs import Neo4jGraph

graph = Neo4jGraph()

# Import movie information

movies_query = """
LOAD CSV WITH HEADERS FROM
'https://raw.githubusercontent.com/tomasonjo/blog-datasets/main/movies/movies_small.csv'
AS row
MERGE (m:Movie {id:row.movieId})
SET m.released = date(row.released),
    m.title = row.title,
    m.imdbRating = toFloat(row.imdbRating)
FOREACH (director in split(row.director, '|') |
    MERGE (p:Person {name:trim(director)})
    MERGE (p)-[:DIRECTED]->(m))
FOREACH (actor in split(row.actors, '|') |
    MERGE (p:Person {name:trim(actor)})
    MERGE (p)-[:ACTED_IN]->(m))
FOREACH (genre in split(row.genres, '|') |
    MERGE (g:Genre {name:trim(genre)})
    MERGE (m)-[:IN_GENRE]->(g))
"""

graph.query(movies_query)
```

```output
[]
```

## ã‚°ãƒ©ãƒ•ã‚¹ã‚­ãƒ¼ãƒ

LLMãŒCypherã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã«ã¯ã€ã‚°ãƒ©ãƒ•ã‚¹ã‚­ãƒ¼ãƒã«é–¢ã™ã‚‹æƒ…å ±ãŒå¿…è¦ã§ã™ã€‚ã‚°ãƒ©ãƒ•ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹ã¨ã€ã‚°ãƒ©ãƒ•ã‚¹ã‚­ãƒ¼ãƒã«é–¢ã™ã‚‹æƒ…å ±ãŒå–å¾—ã•ã‚Œã¾ã™ã€‚å¾Œã§ã‚°ãƒ©ãƒ•ã«å¤‰æ›´ã‚’åŠ ãˆãŸå ´åˆã¯ã€`refresh_schema`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ã‚’æ›´æ–°ã§ãã¾ã™ã€‚

```python
graph.refresh_schema()
print(graph.schema)
```

```output
Node properties are the following:
Movie {imdbRating: FLOAT, id: STRING, released: DATE, title: STRING},Person {name: STRING},Genre {name: STRING},Chunk {id: STRING, question: STRING, query: STRING, text: STRING, embedding: LIST}
Relationship properties are the following:

The relationships are the following:
(:Movie)-[:IN_GENRE]->(:Genre),(:Person)-[:DIRECTED]->(:Movie),(:Person)-[:ACTED_IN]->(:Movie)
```

ã‚ˆã—ã€ã‚¯ã‚¨ãƒªã§ãã‚‹ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒã§ãã¾ã—ãŸã€‚ã•ã£ããLLMã¨é€£æºã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

## ãƒã‚§ãƒ¼ãƒ³

è³ªå•ã‚’å—ã‘å–ã‚Šã€ãã‚Œã‚’Cypherã‚¯ã‚¨ãƒªã«å¤‰æ›ã—ã€ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¦ã€ãã®çµæœã‚’ä½¿ã£ã¦å…ƒã®è³ªå•ã«å›ç­”ã™ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªãƒã‚§ãƒ¼ãƒ³ã‚’ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![graph_chain.webp](../../../../../../static/img/graph_chain.webp)

LangChainã«ã¯ã€ã“ã®ä½œæ¥­ãƒ•ãƒ­ãƒ¼ã«åˆã‚ã›ã¦è¨­è¨ˆã•ã‚ŒãŸNeo4jç”¨ã®çµ„ã¿è¾¼ã¿ãƒã‚§ãƒ¼ãƒ³ãŒã‚ã‚Šã¾ã™: [GraphCypherQAChain](/docs/integrations/graphs/neo4j_cypher)

```python
from langchain.chains import GraphCypherQAChain
from langchain_openai import ChatOpenAI

llm = ChatOpenAI(model="gpt-3.5-turbo", temperature=0)
chain = GraphCypherQAChain.from_llm(graph=graph, llm=llm, verbose=True)
response = chain.invoke({"query": "What was the cast of the Casino?"})
response
```

```output


[1m> Entering new GraphCypherQAChain chain...[0m
Generated Cypher:
[32;1m[1;3mMATCH (:Movie {title: "Casino"})<-[:ACTED_IN]-(actor:Person)
RETURN actor.name[0m
Full Context:
[32;1m[1;3m[{'actor.name': 'Joe Pesci'}, {'actor.name': 'Robert De Niro'}, {'actor.name': 'Sharon Stone'}, {'actor.name': 'James Woods'}][0m

[1m> Finished chain.[0m
```

```output
{'query': 'What was the cast of the Casino?',
 'result': 'The cast of Casino included Joe Pesci, Robert De Niro, Sharon Stone, and James Woods.'}
```

# é–¢ä¿‚æ€§ã®æ–¹å‘æ€§ã®æ¤œè¨¼

LLMã¯ç”Ÿæˆã—ãŸCypherã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®é–¢ä¿‚æ€§ã®æ–¹å‘æ€§ã‚’æ‰±ã†ã®ãŒé›£ã—ã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã‚°ãƒ©ãƒ•ã‚¹ã‚­ãƒ¼ãƒãŒäº‹å‰ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€`validate_cypher`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ã£ã¦ç”Ÿæˆã•ã‚ŒãŸCypherã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®é–¢ä¿‚æ€§ã®æ–¹å‘æ€§ã‚’æ¤œè¨¼ã—ã€å¿…è¦ã«å¿œã˜ã¦ä¿®æ­£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```python
chain = GraphCypherQAChain.from_llm(
    graph=graph, llm=llm, verbose=True, validate_cypher=True
)
response = chain.invoke({"query": "What was the cast of the Casino?"})
response
```

```output


[1m> Entering new GraphCypherQAChain chain...[0m
Generated Cypher:
[32;1m[1;3mMATCH (:Movie {title: "Casino"})<-[:ACTED_IN]-(actor:Person)
RETURN actor.name[0m
Full Context:
[32;1m[1;3m[{'actor.name': 'Joe Pesci'}, {'actor.name': 'Robert De Niro'}, {'actor.name': 'Sharon Stone'}, {'actor.name': 'James Woods'}][0m

[1m> Finished chain.[0m
```

```output
{'query': 'What was the cast of the Casino?',
 'result': 'The cast of Casino included Joe Pesci, Robert De Niro, Sharon Stone, and James Woods.'}
```

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ã‚ˆã‚Šè¤‡é›‘ãªã‚¯ã‚¨ãƒªç”Ÿæˆã«ã¯ã€few-shotãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ä½œæˆã‚„ã‚¯ã‚¨ãƒªãƒã‚§ãƒƒã‚¯ã®ã‚¹ãƒ†ãƒƒãƒ—ã®è¿½åŠ ãŒå¿…è¦ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ã‚ˆã†ãªé«˜åº¦ãªæ‰‹æ³•ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„:

* [ãƒ—ãƒ­ãƒ³ãƒ—ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥](/docs/use_cases/graph/prompting): é«˜åº¦ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã®æ‰‹æ³•
* [å€¤ã®ãƒãƒƒãƒ”ãƒ³ã‚°](/docs/use_cases/graph/mapping): è³ªå•ã‹ã‚‰å€¤ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹æ‰‹æ³•
* [ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼](/docs/use_cases/graph/semantic): ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å®Ÿè£…æ‰‹æ³•
* [ã‚°ãƒ©ãƒ•ã®æ§‹ç¯‰](/docs/use_cases/graph/constructing): ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ã®æ§‹ç¯‰æ‰‹æ³•
