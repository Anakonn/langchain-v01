---
sidebar_position: 2
translated: true
---

# 테스트

모든 패키지에는 유닛 테스트와 통합 테스트가 있으며, 우리는 통합 테스트보다 유닛 테스트를 선호합니다.

유닛 테스트는 모든 풀 리퀘스트에서 실행되므로 빠르고 신뢰할 수 있어야 합니다.

통합 테스트는 하루에 한 번 실행되며, 더 많은 설정이 필요하므로 외부 서비스와의 인터페이스 포인트를 확인하는 데 사용해야 합니다.

## 유닛 테스트

유닛 테스트는 외부 API 호출이 필요 없는 모듈식 논리를 다룹니다.
새로운 논리를 추가하는 경우 유닛 테스트를 추가하세요.

유닛 테스트를 위한 종속성을 설치하려면:

```bash
poetry install --with test
```

유닛 테스트를 실행하려면:

```bash
make test
```

Docker에서 유닛 테스트를 실행하려면:

```bash
make docker_tests
```

특정 테스트를 실행하려면:

```bash
TEST_FILE=tests/unit_tests/test_imports.py make test
```

## 통합 테스트

통합 테스트는 외부 API 호출이 필요한 논리를 다룹니다 (종종 다른 서비스와의 통합).
새로운 외부 API에 대한 지원을 추가하는 경우 새로운 통합 테스트를 추가하세요.

**경고:** 거의 모든 테스트는 통합 테스트가 아니어야 합니다.

네트워크 연결이 필요한 테스트는 다른 개발자가 코드를 테스트하기 어렵게 만듭니다.

대신 `responses` 라이브러리 및/또는 mock.patch를 사용하여 작은 픽스처를 사용하여 요청을 모킹하는 것을 선호하세요.

통합 테스트를 위한 종속성을 설치하려면:

```bash
poetry install --with test,test_integration
```

통합 테스트를 실행하려면:

```bash
make integration_tests
```

### 준비

통합 테스트는 여러 검색 엔진과 데이터베이스를 사용합니다. 테스트는 엔진과 데이터베이스의 사양 및 요구 사항에 따라 올바른 동작을 확인하는 것을 목표로 합니다.

일부 통합 테스트를 실행하려면, 예를 들어 `tests/integration_tests/vectorstores/`에 있는 테스트를 실행하려면 다음 소프트웨어를 설치해야 합니다:

- Docker
- Python 3.8.1 이상

새 종속성을 추가해야 하는 경우 다음 명령을 실행합니다:

```bash
# 패키지를 추가하고 추가한 후 설치:

poetry add tiktoken@latest --group "test_integration" && poetry install --with test_integration
```

모든 테스트를 실행하기 전에 필요한 종속성이 설치된 특정 Docker 컨테이너를 시작해야 합니다. 예를 들어, `test_elasticsearch.py`에 `elasticsearch.yml` 컨테이너를 사용합니다:

```bash
cd tests/integration_tests/vectorstores/docker-compose
docker-compose -f elasticsearch.yml up
```

더 복잡한 준비가 필요한 환경의 경우, `*.sh` 파일을 찾으세요. 예를 들어, `opensearch.sh`는 필요한 도커 이미지를 빌드한 다음 opensearch를 실행합니다.

### 로컬 테스트를 위한 환경 변수를 준비하세요:

- `tests/integration_tests/.env.example`을 `tests/integration_tests/.env`로 복사합니다.
- `tests/integration_tests/.env` 파일에 변수 설정, 예: `OPENAI_API_KEY`

또한, 일부 통합 테스트는 `OPENAI_API_KEY`와 같은 특정 환경 변수를 설정해야 할 수 있다는 점을 유념하세요. 테스트를 실행하기 전에 필요한 환경 변수를 설정하여 테스트가 올바르게 실행되도록 하세요.

### pytest-vcr을 사용하여 HTTP 상호작용 기록

이 리포지토리의 일부 통합 테스트는 외부 서비스에 HTTP 요청을 수행합니다. 이러한 요청이 테스트가 실행될 때마다 수행되지 않도록 하기 위해 pytest-vcr을 사용하여 HTTP 상호작용을 기록하고 재생합니다.

CI/CD 파이프라인에서 테스트를 실행할 때는 기존 카세트를 수정하지 않으려 할 수 있습니다. --vcr-record=none 명령줄 옵션을 사용하여 새로운 카세트 기록을 비활성화할 수 있습니다. 예를 들어:

```bash
pytest --log-cli-level=10 tests/integration_tests/vectorstores/test_pinecone.py --vcr-record=none
pytest tests/integration_tests/vectorstores/test_elasticsearch.py --vcr-record=none
```

### 일부 테스트를 커버리지와 함께 실행

```bash
pytest tests/integration_tests/vectorstores/test_elasticsearch.py --cov=langchain --cov-report=html
start "" htmlcov/index.html || open htmlcov/index.html
```

## 커버리지

코드 커버리지(즉, 유닛 테스트로 커버되는 코드의 양)는 코드의 잠재적으로 더 취약한 영역을 식별하는 데 도움이 됩니다.

커버리지는 통합 테스트의 종속성을 필요로 합니다:

```bash
poetry install --with test_integration
```

현재 커버리지 보고서를 얻으려면 다음을 실행합니다:

```bash
make coverage
```